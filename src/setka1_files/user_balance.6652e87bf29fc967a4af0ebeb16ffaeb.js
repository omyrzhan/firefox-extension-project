var user_balance={state:{accounts:[],bonuses:[],isShowBonusInHeader:false,isCryptoRef:false,hasUserAgreeBonus:0,hasUserBets:false,promo:0,main:0,lastRequestTime:0,freezeAccount:false,supportMultiAccounts:true},getMainBalance:function(){var money=0;var _this=this;_this.state.accounts.some(function(account){if(account.is_active){money=account.money;return true}return false});return money},getBalance:function(callback){balance.methods.getBalance(callback)},getAllIdCurrencies:function(){return this.state.accounts.filter(function(account){return[9,0,6].indexOf(account.type)!==-1}).map(function(account){return account.id_currency})},getAllCurrencyAccounts:function(){return this.state.accounts.filter(function(account){return[9,6].indexOf(account.type)!==-1})},getPrimaryUserId:function(){var id=0;this.state.accounts.some(function(account){if(!account.type){id=account.id;return true}});return id},getSelectAccount:function(){var balance=[];this.state.accounts.some(function(account){if(account.is_active){balance=account;return true}});return balance},is_bonus:function(id){id=id||0;var is_bonus=false;this.state.accounts.some(function(account){if(account.id==id){is_bonus=[9,0,6].indexOf(account.type)==-1}});return is_bonus},getMainBalanceCurrency:function(){var iso=typeof GEO_CURRENCY!=="undefined"?GEO_CURRENCY.code:"";var _this=this;_this.state.accounts.some(function(account){if(account.is_active){iso=account.iso;return true}return false});return iso},getPrimaryCurrencyId:function(){var id=typeof GEO_CURRENCY!=="undefined"?GEO_CURRENCY.id:1;this.state.accounts.some(function(account){if(!account.type){id=account.id_currency;return true}return false});return id},getPrimaryCurrency:function(){var iso=typeof GEO_CURRENCY!=="undefined"?GEO_CURRENCY.code:"";var _this=this;_this.state.accounts.some(function(account){if(!account.type){iso=account.iso;return true}return false});return iso},getMainUserId:function(){var id=0;var _this=this;if(_this.state.accounts){_this.state.accounts.some(function(account){if(account.is_active){id=account.id;return true}return false})}return id},getCurrency:function(id,defaultValue){var iso=defaultValue||"";this.state.accounts.some(function(account){if(account.id==id){iso=account.iso;return true}});return iso},updateBalance:function(id,money){this.state.accounts=this.state.accounts.map(function(account){account.money=id==account.id?money:account.money;return account})},setPoints:function(money){money=money||0;this.state.promo=money},getUserRefId:function(){var main_account=this.state.accounts.find(function(account){return account.is_active});if(!main_account){return 0}return main_account.ref_id},getBonusAccount:function(){return this.state.accounts.find(function(account){return account.type===4})},balanceUpdate:function(id,money){id=id||0;money=money||0;if(id){user_balance.updateBalance(id,money);window.dispatchEvent(new Event("balance.update_done"));return}user_balance.getBalance();$("#coupon_balance").html(user_balance.getMainBalance())},setFreezeAccount:function(isFreeze){this.state.freezeAccount=isFreeze},setSupportMultiAccounts:function(isSupport){this.state.supportMultiAccounts=isSupport}};var balance={template:"#user_balance",props:["firstrender"],constants:{timeForWait:5e3},data:function(){return user_balance.state},methods:{getBalanceWithThrottle:function(){var _this_$analytics=this.$analytics,headerV2=_this_$analytics.headerV2,$constants=_this_$analytics.$constants;headerV2.clickOnButton($constants.HEADER_BUTTONS.BUTTON_REFRESH_FUNDS);if(Date.now()-this.lastRequestTime<this.$consts.timeForWait){return}this.getBalance();this.lastRequestTime=Date.now()},getBalance:function(callback){var _this=this;_this.getRequest().then(function(data){_this.setDecoration(data);if(typeof callback==="function"){callback()}}).catch(function(e){console.log("error in balance",e)})},setDecoration:function(data){data=data||[];var _this=this;var balance=data.balance.map(function(account){if(account.id==_this.main){_this.promo=account.PointsBalance}var fields={id:account.id,type:account.typ,money:account.money,name:account.AccountName,iso:account.kode,is_active:account.active,id_currency:account.idCurrecy,summ_unplaced_bets:account.summ_unplaced_bets,ref_id:account.refID};return fields});user_balance.state.accounts=balance;this.setBalanceToStore(typeof window.store_global==="undefined"||typeof window.store_global.state.global==="undefined",data);if(typeof Games!=="undefined"&&Games.customBalance.need_show){Games.customBalance.setBalance()}window.dispatchEvent(new Event("balance.update_done"))},getRequest:function(){return new Promise(function(resolve,reject){$.get("/api/internal/user/balance",function(response){if(response.success){resolve(response)}})})},setBalanceToStore:function(need_interval,data){var interval=null;interval=setInterval(function(){if(typeof window.store_global!=="undefined"&&typeof window.store_global.state.global!=="undefined"){window.store_global.commit("set_user_id");window.store_global.commit("global/"+"globalSetUserId",user_balance.getMainUserId());window.store_global.commit("global/"+"globalSetUserRefId",user_balance.getUserRefId());if(typeof window.store_global.state.account!=="undefined"&&typeof data.balance!=="undefined"&&typeof data.bonus!=="undefined"&&typeof data.all_accounts!=="undefined"){window.store_global.commit("account/"+"accountParseAndSetData",data)}clearInterval(interval)}},need_interval?300:1)},setBalance:function(id){var iso="";var _this=this;if(this.accounts.some(function(account){return account.id==id&&account.is_active})){return}if(this.freezeAccount){alerts(dictionary.attention,dictionary.xgames_main_account_frozen,2);return}if(typeof SUPPORT_MULTI_ACCOUNTS!=="undefined"&&!SUPPORT_MULTI_ACCOUNTS&&typeof SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE!=="undefined"&&SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE||!this.supportMultiAccounts){alerts(dictionary.attention,dictionary.not_balance_section,2);return}this.accounts=this.accounts.map(function(account){account.is_active=account.id==id;if(account.is_active){iso=account.iso}return account});Core.cookie.set("activeid",id);$.post("/api/internal/user/set-active-account",{id:id},function(response){if(!response.success){alerts("",response.message,0);_this.accounts=_this.accounts.map(function(account){account.is_active=account.id==response.id;return account});Core.cookie.set("activeid",response.id);return}$(".coupon_currency").html(iso);$("#coupon_balance").html(user_balance.getMainBalance());$(window).trigger("balance.change");window.dispatchEvent(new Event("balance.change"));document.dispatchEvent(new CustomEvent("sumbets.change"));if(window.Popup.isOpen("fastDeposit")){$.arcticmodal("close");window.Popup.init("fastDeposit")}_this.setDecoration(response);typeof store_sale!=="undefined"&&store_sale.commit("initInfo")})},setBonuses:function(bonuses){this.bonuses=bonuses.map(function(bonus){return{name:bonus.Trslt_BonusName||bonus.BonusName,bonusId:bonus.idBonus,start:bonus.bonus_start,end:bonus.bonus_finish,cur:bonus.bonus_fact,curNormalized:Math.max(bonus.bonus_start,bonus.bonus_fact),progress:parseFloat(bonus.bonus_fact*100/(bonus.bonus_finish-bonus.bonus_start))+"%"}})},setVisibilityShowBonusInHeader:function(isShowBonusInHeader){this.isShowBonusInHeader=isShowBonusInHeader},setIsCryptoRef:function(isCryptoRef){this.isCryptoRef=isCryptoRef},setUserAgreeBonus:function(hasUserAgreeBonus){this.hasUserAgreeBonus=hasUserAgreeBonus},setUserHasBets:function(hasUserBets){this.hasUserBets=hasUserBets}},computed:{_currency:function(){return this.accounts.filter(function(account){return[9,0,6].indexOf(account.type)!==-1})},_active:function(){var active={};this.accounts.some(function(account){if(account.is_active){active=account}return account.is_active});return active},_other:function(){return this.accounts.filter(function(account){return[9,0,6].indexOf(account.type)==-1})},_bonuses:function(){var _this=this;return this.bonuses.map(function(account,index){Vue.set(_this.bonuses[index],"width",account.width=100*account.cur/account.end);return account})},_bonus_count:function(){return this.bonuses.length},_hasWelcomeBonus:function(){return Boolean(this.bonuses.find(function(bonus){return bonus.bonusId===199}))},_isWelcomeBonusVisible:function(){return(this.hasUserAgreeBonus===0||this.hasUserBets===false||this._hasWelcomeBonus)&&this.isCryptoRef},$_visible_balance:function(){return typeof this._currency[0]!=="undefined"?this._currency[0]:{}}},beforeMount:function(){var id=Core.cookie.get("ua",0);var _this=this;if(id){this.main=id;this.setDecoration({balance:this.firstrender.balance});this.setBonuses(this.firstrender.bonus);this.setUserAgreeBonus(Number(this.firstrender.hasUserAgreeBonus));this.setUserHasBets(this.firstrender.hasUserBets);this.setIsCryptoRef(this.firstrender.isCryptoRef);if(this.firstrender.isShowBonusInHeader){this.setVisibilityShowBonusInHeader(true)}document.dispatchEvent(new CustomEvent("sumbets.change"));typeof store_sale!=="undefined"&&!store_sale.getters.show&&store_sale.commit("initInfo")}else{console.log("not auth")}},mounted:function(){var accounts=this.accounts.filter(function(account){return[7,9,6,13].indexOf(account.type)==-1});if(accounts.length>1){$(".coupon-account").show()}var hasActiveAccounts=this.accounts.some(function(account){if(account.is_active){$(".coupon_currency").html(account.iso);$("#coupon_balance").html(user_balance.getMainBalance());return true}return false});if(!hasActiveAccounts){this.getBalance()}var self=this;if(window.IFRAME_REF_ID){window.addEventListener("message",function(event){if(event.data.event_name==="set_active_account"){self.setBalance(event.data.new_id)}})}window.addEventListener("onBalanceChange",function(e){if(e.detail){return self.setDecoration(e.detail)}self.getBalance()})}};if(typeof HIDE_BALANCE!=="undefined"&&!HIDE_BALANCE){if(!Core.cookie.get("ua",0)){document.addEventListener("load.header",function(){new Vue({el:"#user-money",components:{user_balance:balance},created:function(){$(".user-money_before").remove();if(typeof SUPPORT_MULTI_ACCOUNTS!=="undefined"&&!SUPPORT_MULTI_ACCOUNTS&&typeof SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE!=="undefined"&&SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE){alerts(dictionary.attention,dictionary.not_balance_section,2)}}})})}else{$(document).on("load.user.money",function(){new Vue({el:"#user-money",components:{user_balance:balance},created:function(){$(".user-money_before").remove();if(typeof SUPPORT_MULTI_ACCOUNTS!=="undefined"&&!SUPPORT_MULTI_ACCOUNTS&&typeof SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE!=="undefined"&&SUPPORT_MULTI_ACCOUNTS_POPUP_VISIBLE){alerts(dictionary.attention,dictionary.not_balance_section,2)}}})})}}$(window).on("balance.update",user_balance.balanceUpdate);$(document).on("ready",function(){if(typeof IFRAME_CHECK_BALANCE!=="undefined"||typeof HIDE_BALANCE!=="undefined"&&HIDE_BALANCE){user_balance.getBalance();$("#coupon_balance").html(user_balance.getMainBalance())}});