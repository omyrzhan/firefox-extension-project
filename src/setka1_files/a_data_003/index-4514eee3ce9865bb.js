(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{17703:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(70150)}])},27713:()=>{},70150:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__N_SSP:()=>rq,default:()=>rZ});var a=r(6029),i=r(27189),n=r(37153),s=r(27124),o=r(4419),l=r(51817),c=r(82779),d=r(55729),u=r(76753),m=r(62353),p=r(13761),g=r(50869),f=r(67626),h=r(90975),x=r(45293),v=r(84593),b=r(45501),y=r(3197),j=r(66488),k=r(35340),w=r(70969),C=r(90012),I=r(26500),M=r(86320);function N(e,t){let r=h.A.getState().env;if(void 0!==e&&e.trim()&&((null==r?void 0:r.APP_ENV)!=="production"||t))return{"data-testid":e}}var S=r(38169);let R=(0,S.r)((e,t)=>{let{withShadow:r}=t;return{indicator:{position:"absolute","&.enter":{opacity:0,transform:"scale(0.9)"},"&.enter-active":{opacity:1,transform:"scale(1)",transition:"opacity 400ms, transform 400ms"},"&.exit":{opacity:1,transform:"scale(1)"},"&.exit-active":{opacity:0,transform:"scale(0.9)",transition:"opacity 100ms, transform 100ms"}},button:{padding:"0 0px 2px 1px",...r&&{boxShadow:"0 10px 25px 0 rgba(0, 0, 0, .10)"}}}});var A=r(67353);function T(e){return!!e&&"object"==typeof e}let z=e=>{let{onOpenWidget:t,opener:r,orientation:i,unreadMessageCount:n}=e,s=function(e){if(!T(e))return A.IH;if("number"==typeof e.size)return e.size;let t={small:A._,middle:A.IH,large:A.O2};return e.size?t[e.size]:A.IH}(r),o=Math.round(.6*s),l=function(e){if(T(e))return e.unreadIndicator}(r),{classes:c}=R({withShadow:function(e){return!T(e)||"none"!==e.shadow}(r)});return(0,a.jsx)(C.C,{className:c.indicator,color:"red.8",disabled:!n,label:"simple"===l?null:n,offset:8,size:"simple"===l?18:24,style:{[i]:0,bottom:0},...N("widget-button-indicator"),children:(0,a.jsx)(I.M,{className:c.button,color:"primaryColor",onClick:t,size:s,style:{borderRadius:"50%"},variant:"filled",...N("open-widget-button",!0),children:(0,a.jsx)(M.bYO,{fill:"white",size:o})})})};var B=r(43790),D=r(61604),E=r.n(D);let _=(0,S.r)((e,t)=>{let{isMobile:r}=t;return{root:{height:"100%",padding:r?0:A.el,position:"relative",width:"100%"},container:{height:"100%",position:"relative",width:"100%"}}});var P=r(58555),F=r(28455),H=r(10815),G=r(37948),O=r(24170),W=r.n(O);let L=(0,S.r)(()=>({wrapper:{textAlign:"center",flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"},title:{fontSize:20,fontWeight:500,margin:"20px 0 10px"}})),$=e=>{let{img:t,alertTitle:r,alertMessage:i}=e,{classes:n}=L();return(0,a.jsxs)("div",{className:n.wrapper,children:[t&&(0,a.jsx)(W(),{alt:"",src:t}),(0,a.jsx)(G.E,{className:n.title,children:r}),(0,a.jsx)(G.E,{children:i})]})},V={src:"/_next/static/media/401-error.093d6ff7.svg",height:160,width:160,blurWidth:0,blurHeight:0},X={src:"/_next/static/media/5xx-error.0e2915f7.svg",height:144,width:138,blurWidth:0,blurHeight:0},U=(0,d.memo)(e=>{let{appStatus:t,authError:r}=e,[i]=(0,H.Bd)(),n=(0,d.useMemo)(()=>{if(t!==B.i.Ready)return t===B.i.Error?{color:"red",message:i("Ошибка соединения. Попробуйте перезагрузить приложение или обратиться в поддержку.")}:t===B.i.Reconnecting?{color:"blue",message:i("Переподключение")+"..."}:{color:"blue",message:i("Синхронизация")+"..."}},[i,t]),s=(0,d.useMemo)(()=>{if(r)return r>=500?{image:X,message:i("Чат с поддержкой станет доступен \nв ближайшее время. \nПриносим свои извинения."),title:i("Ведутся технические работы")}:401===r?{image:V,message:i("Обратитесь в поддержку через другие \nканалы связи."),title:i("Что-то пошло не так")}:{image:V,message:String(r),title:"Auth message"}},[i,r]);return s?(0,a.jsx)($,{alertMessage:(0,a.jsx)(F.oz,{children:s.message}),alertTitle:s.title,img:s.image}):n?(0,a.jsx)(P.F,{color:n.color,icon:(0,a.jsx)(M.GBC,{size:16}),children:n.message}):null});U.displayName="WidgetAppAlert";var Y=r(11594),J=r(11581);let q=(0,S.r)(()=>({root:{position:"absolute",borderRadius:"10px !important",overflow:"hidden"},overlay:{position:"absolute !important"},inner:{paddingLeft:24,paddingRight:24},modal:{width:"100%",maxWidth:300,borderRadius:10},close:{"&:focus":{outline:0},"&:focus-visible":{outline:0}},header:{position:"absolute",right:15,top:10}}));var Z=r(13445),K=r(50433),Q=r(81231),ee=r(29584),et=r(94408);let er=(0,S.r)((e,t)=>{let{size:r="default"}=t;return{root:{boxSizing:"border-box",display:"inline-block",margin:0,padding:0,color:e.colors.orange[3],fontVariant:"tabular-nums",fontFeatureSettings:"'tnum'",fontSize:0,lineHeight:"unset",listStyle:"none",outline:"none","&.rc-rate-disabled":{".rc-rate-star":{cursor:"default","> div:hover":{transform:"scale(1)"}}},".rc-rate-star":{position:"relative",display:"inline-block",color:"inherit",cursor:"pointer","&:not(:last-child)":{marginRight:(()=>{switch(r){case"small":return 4;case"large":return 10;default:return 8}})()},"> div":{transition:"all 0.3s, outline 0s","&:hover":{transform:"scale(1.1)"},"&:focus":{outline:0},"&:focus-visible":{outline:"1px dashed ".concat(e.colors.orange[3]),transform:"scale(1.1)"}}},".rc-rate-star-first, .rc-rate-star-second":{color:e.colors.gray[3],transition:"all 0.3s",userSelect:"none",".rcicon":{verticalAlign:"middle"}},".rc-rate-star-first":{position:"absolute",top:0,left:0,width:"50%",height:"100%",overflow:"hidden",opacity:0},".rc-rate-star-half":{".rc-rate-star-first, .rc-rate-star-second":{opacity:1}},".rc-rate-star-half .rc-rate-star-first, .rc-rate-star-full .rc-rate-star-second":{color:"inherit"},".rc-rate-text":{display:"inline-block",margin:(()=>{switch(r){case"small":return"0 4px";case"large":return"0 10px";default:return"0 8px"}})(),fontSize:15}}}}),ea=d.forwardRef((e,t)=>{let{tooltips:r,character:i,size:n="default",className:s,...o}=e,l=(()=>{switch(n){case"small":return 16;case"large":return 30;default:return 20}})();i=i||(0,a.jsx)(M.aGI,{style:{fill:"currentColor"},size:l});let{classes:c,cx:d}=er({size:n});return(0,a.jsx)(ee.A,{...o,ref:t,className:d(c.root,s),character:i,characterRender:(e,t)=>{let{index:i}=t;return r&&void 0!==i?(0,a.jsx)(et.m,{label:r[i],withArrow:!0,children:e}):e}})}),ei=(0,S.r)(e=>({form:{width:"100%"},mark:{color:e.colors.red[6],marginRight:3},rateBlock:{display:"block",paddingTop:10},errorsBlock:{color:e.colors.red[6],fontSize:11},requiredText:{marginTop:15}})),en=e=>{let{form:t}=e,[r]=(0,H.Bd)(),{classes:i}=ei();return(0,a.jsx)("form",{className:i.form,...N("feedback-form"),children:(0,a.jsxs)(Z.B,{spacing:15,children:[(0,a.jsxs)(K.a,{children:[(0,a.jsxs)(G.E,{fz:"sm",children:[(0,a.jsx)("span",{className:i.mark,children:"*"}),r("Мы решили ваш вопрос?")]}),(0,a.jsxs)(Q.s.Group,{...t.getInputProps("resolved"),children:[(0,a.jsx)(Q.s,{label:r("Да"),value:"true",...N("resolved-radio-button")}),(0,a.jsx)(Q.s,{label:r("Нет"),value:"false",...N("unresolved-radio-button")})]})]}),(0,a.jsxs)(K.a,{children:[(0,a.jsxs)(G.E,{fz:"sm",children:[(0,a.jsx)("span",{className:i.mark,children:"*"}),r("Насколько вы удовлетворены работой консультантов нашей службы поддержки?")]}),(0,a.jsx)(ea,{...t.getInputProps("rate"),className:i.rateBlock,size:"large"}),(0,a.jsx)(K.a,{className:i.errorsBlock,mt:5,children:t.errors.rate})]}),(0,a.jsxs)(G.E,{fz:"xs",className:i.requiredText,children:[(0,a.jsx)("span",{className:i.mark,children:"*"}),r("обязательно к заполнению")]})]})})};var es=r(16947),eo=r(84335);let el=(0,S.r)(()=>({container:{textAlign:"center"},buttonGroup:{width:"80%"}})),ec=e=>{let{onContinue:t,onLeave:r}=e,[i]=(0,H.Bd)(),{classes:n}=el();return(0,a.jsxs)(Z.B,{className:n.container,spacing:15,children:[i("Вы действительно хотите закрыть форму?"),(0,a.jsxs)(es.Y,{className:n.buttonGroup,m:"0 auto",spacing:8,children:[(0,a.jsx)(eo.$,{fullWidth:!0,onClick:r,type:"submit",...N("close-form-button"),children:i("Да, закрыть")}),(0,a.jsx)(eo.$,{fullWidth:!0,onClick:t,variant:"default",...N("return-to-form-button"),children:i("Нет, продолжить")})]})]})},ed=(0,S.r)(()=>({container:{textAlign:"center"}})),eu=()=>{let[e]=(0,H.Bd)(),{classes:t}=ed();return(0,a.jsx)(K.a,{className:t.container,m:"0 auto",children:e("Спасибо за оценку качества обслуживания")})},em=(0,d.memo)(e=>{let{open:t,reset:r,submit:i}=e,[n]=(0,H.Bd)(),{classes:s}=q(),[o,l]=(0,d.useState)("form"),c=(0,d.useRef)(),u=(0,J.m)({initialValues:{rate:0,resolved:void 0},validate:{rate:e=>e?null:n("Оценка обязательна"),resolved:e=>e?null:n("Выбор обязателен")}}),m=(0,d.useCallback)(()=>{r(),u.reset(),u.clearErrors(),l("form")},[u,r]),p=(0,d.useCallback)(()=>{"form"===o?l("incomplete"):m()},[o,m]),g=(0,d.useCallback)(()=>l("form"),[]),f=(0,d.useCallback)(()=>u.setFieldError("rate",n("Не удалось отправить, попробуйте еще раз")),[n,u]),h=(0,d.useCallback)(()=>{l("result"),c.current=setTimeout(m,3e3)},[m]);return(0,d.useEffect)(()=>{u.values.rate>0&&u.values.resolved&&i({onFailure:f,onSuccess:h,rate:u.values.rate,resolved:"false"!==u.values.resolved})},[u.values.rate,u.values.resolved]),(0,d.useEffect)(()=>()=>{c.current&&clearTimeout(c.current)},[]),(0,a.jsxs)(Y.a,{centered:!0,classNames:s,onClose:p,opened:t,transition:"fade",transitionDuration:0,withCloseButton:"incomplete"!==o,withinPortal:!1,children:["form"===o&&(0,a.jsx)(en,{form:u}),"result"===o&&(0,a.jsx)(eu,{}),"incomplete"===o&&(0,a.jsx)(ec,{onContinue:g,onLeave:m})]})});em.displayName="FeedbackForm";var ep=r(58597);let eg={src:"/_next/static/media/files-upload.cdddc3b1.svg",height:113,width:189,blurWidth:0,blurHeight:0},ef=(0,S.r)((e,t)=>({dropzone:{height:"100%",outline:"none !important"},area:{backgroundColor:"rgba(16, 17, 19, 0.45)",borderRadius:8,inset:0,padding:t.inModal?0:"50px 20px",position:"absolute",zIndex:1},container:{backgroundColor:"".concat(e.colors.gray[1]),borderRadius:8,height:"100%",position:"relative",width:"100%"},content:{border:"1px dashed ".concat(e.colors.gray[5]),borderRadius:8,display:"flex",flexDirection:"column",fontSize:16,gap:16,height:"calc(100% - 40px)",justifyContent:"center",padding:30,textAlign:"center",transform:"translate(20px, 20px)",width:"calc(100% - 40px)"}})),eh=(0,d.memo)(e=>{let{children:t,disabled:r,inModal:i,maxFiles:n,onDrop:s}=e,[o]=(0,H.Bd)(),{classes:l}=ef({inModal:i}),{getInputProps:c,getRootProps:d,isDragActive:u}=(0,ep.VB)({disabled:r,maxFiles:n,multiple:n>1,onDrop:s,noClick:!0});return(0,a.jsxs)("div",{...d({className:l.dropzone}),children:[(0,a.jsx)("input",{...c()}),t,u&&(0,a.jsx)("div",{className:l.area,children:(0,a.jsx)("div",{className:l.container,children:(0,a.jsxs)("div",{className:l.content,children:[!i&&(0,a.jsx)(W(),{alt:"",src:eg}),(0,a.jsx)("span",{children:o("Перетащите сюда файл(ы) для быстрой отправки")})]})})})]})});eh.displayName="WidgetMediaDropzone";var ex=r(66179),ev=r(62899);function eb(e){let{interval:t,slowMode:r}=e,[,a]=(0,ev.A)({interval:t,leftTime:(0,d.useMemo)(()=>{if(r.active)return r.getDiffMs(r.duration,r.activeSince)},[r])});return(0,d.useMemo)(()=>{if(r.active)return{formatted:function(e){let{minutes:t,seconds:r}=e,a=r+1;return"".concat(t<10?"0".concat(t):"".concat(t),":").concat(a<10?"0".concat(a):"".concat(a))}(a),minutes:a.minutes,seconds:a.seconds+1,percentage:(60*a.minutes*1e3+1e3*a.seconds+a.milliseconds)/(1e3*r.duration)*100}},[a,r])}var ey=r(13692),ej=r(59693);let ek={height:147,width:220};function ew(e,t){let r=document.createElement("a");r.setAttribute("href",e),r.setAttribute("download",t||"unknown"),r.setAttribute("target","_blank"),r.click()}function eC(e){var t;let r=null==(t=e.attributes)?void 0:t.find(e=>"DocumentAttributeFileName"===e.$type);return(null==r?void 0:r.name)||""}function eI(e){return A.RJ.has(e.mimeType)}var eM=r(67472),eN=r(94170),eS=r(89650);let eR=new Map,eA={expiryIn:0,uri:""};function eT(e){return{borderRadius:6,color:e.colors.gray[1],cursor:"pointer",opacity:0,position:"absolute",right:0,top:0}}let ez=(0,S.r)(e=>({root:{borderRadius:6,height:"100%",overflow:"hidden",position:"relative",".mantine-Image-root, .mantine-Image-figure, .mantine-Image-imageWrapper":{height:"100%",position:"relative",width:"100%"},img:{height:"100% !important",position:"absolute",width:"100%"},":hover":{".icon":{opacity:1}}},button:{alignItems:"center",display:"flex",height:30,justifyContent:"center",padding:"0 5px",width:30},deleteButtonContainer:{...eT(e),right:4,top:4},downloadButtonContainer:{...eT(e),right:"50%",top:"50%",transform:"translate(50%, -50%)"},refreshButtonContainer:{...eT(e),right:"50%",top:"50%",transform:"translate(50%, -50%)"}})),eB=(0,d.memo)(e=>{let{id:t,name:r,noActions:i,onDelete:n,src:s,type:o}=e,{classes:l,cx:c}=ez(),[u,m]=(0,ej.A)(!1),[p,g]=(0,ej.A)(!0),[f,h]=(0,d.useState)(),x=function(e){let{id:t,src:r,type:a}=e,i=(0,eS.F)((0,eN.N)().api),[n,s]=(0,d.useState)(eA),o=(0,d.useRef)(null),l=(0,eM.A)(),c=(0,d.useCallback)(()=>{o.current&&(clearTimeout(o.current),o.current=null)},[]),u=(0,d.useCallback)(async e=>{try{return await i.current.getDownloadMediaLink(e)}catch(e){return null}},[i]),m=(0,d.useCallback)(async e=>{var t,r;let a,i=eR.get(e);(a=i&&(t=i.expiryIn,!E()(1e3*t).isBefore(E()().valueOf()))?i:await u(e))&&!l.current&&(eR.set(e,a),s(a),o.current=setTimeout(()=>m(e),(r=a.expiryIn,E()(1e3*r).diff(E()(),"ms"))))},[u,l]);return((0,d.useEffect)(()=>("external"===a&&m(t),c),[c,t,m,a]),"internal"===a)?r:n.uri}({id:t,src:s,type:o}),v=(0,d.useCallback)(()=>null==n?void 0:n(t),[t,n]),b=(0,d.useCallback)(()=>ew(x,r),[r,x]),y=(0,d.useCallback)(()=>{m.setTrue(),g.setFalse()},[m,g]),j=(0,d.useCallback)(()=>{m.setFalse(),g.setFalse()},[m,g]),k=(0,d.useCallback)(()=>{h(Date.now()),m.setFalse(),g.setTrue()},[m,g]);return(0,a.jsxs)(K.a,{className:l.root,children:[!!x&&(0,a.jsx)(ey._,{alt:"media-image",fit:"cover",onError:y,onLoad:j,src:f?"".concat(x,"?").concat(f):x}),!!n&&!u&&!p&&!i&&(0,a.jsx)("div",{className:c(l.deleteButtonContainer,"icon"),children:(0,a.jsx)(eo.$,{...N("delete-media-".concat(t)),className:l.button,onClick:v,children:(0,a.jsx)(M.Eau,{size:18})})}),!n&&!u&&!p&&!i&&(0,a.jsx)("div",{className:c(l.downloadButtonContainer,"icon"),children:(0,a.jsx)(eo.$,{...N("".concat(t,"-image-download-button")),className:l.button,onClick:b,children:(0,a.jsx)(M.i8u,{})})}),!n&&u&&!i&&(0,a.jsx)("div",{className:c(l.refreshButtonContainer,"icon"),children:(0,a.jsx)(eo.$,{...N("refresh-media-".concat(t)),className:l.button,onClick:k,children:(0,a.jsx)(M.H42,{})})})]})});eB.displayName="MediaImage";var eD=r(69344);let eE=(0,S.r)(()=>({container:{display:"flex",flexDirection:"column"},row:{display:"flex"},col:{position:"relative"}})),e_={MAX_PHOTOS:3,MIN_PHOTOS:1,PADDING:0,SINGLE_ROW_MAX_HEIGHT:200,SPACING:4,TARGET_ROW_HEIGHT:100},eP=(0,d.memo)(e=>{let{containerMaxWidth:t,items:r,onItemDelete:i,testIdPrefix:n}=e,{classes:s}=eE(),o=(0,d.useMemo)(()=>Math.floor(r.reduce((e,t)=>e+t.width/t.height*e_.SINGLE_ROW_MAX_HEIGHT-2*e_.PADDING,e_.PADDING*r.length*2+e_.SPACING*(r.length-1))),[r]),l=(0,d.useMemo)(()=>(0,eD.A)(r,e_.SPACING,e_.PADDING,Math.min(t,o),e_.TARGET_ROW_HEIGHT,e_.MIN_PHOTOS,e_.MAX_PHOTOS),[t,r,o]),c=(0,d.useCallback)(e=>"photo"===e.variant?(0,a.jsx)(eB,{id:e.id,name:e.name,onDelete:i,src:e.src,type:e.type}):null,[i]);return r.length&&l?(0,a.jsx)("div",{className:s.container,style:{gap:e_.SPACING,width:l.containerWidth},...N("".concat(n,"-media-gallery-view")),children:l.tracks.map((e,t)=>(0,a.jsx)("div",{className:s.row,style:{gap:e_.SPACING},children:e.photos.map(e=>(0,a.jsx)("div",{className:s.col,style:{aspectRatio:String(e.width/e.height),width:"".concat(e.width/l.containerWidth*100,"%")},...N("".concat(n,"-").concat(e.photo.id,"-media-gallery-view-item")),children:c(e.photo)},e.photo.id))},t))}):null});eP.displayName="WidgetMediaGalleryView";var eF=r(18255);let eH=(0,S.r)(()=>({list:{alignItems:"center",listStyleType:"none",width:"100%",".mantine-List-root":{maxWidth:300},".mantine-List-itemWrapper":{width:"100%"},".list-view-item-container":{display:"flex"}}})),eG=(0,S.r)((e,t)=>{let{threeColumned:r}=t;return{listItem:{alignItems:"center",display:"grid",gap:8,gridTemplateColumns:"40px 1fr",width:"100%",...r&&{gridTemplateColumns:"40px 1fr 32px"}},listItemVariantImage:{"> div":{height:"100%"}},listItemVariantFile:{alignItems:"center",borderRadius:"50%",display:"flex",height:40,justifyContent:"center",padding:0,width:40},listItemInfo:{display:"grid"},listItemInfoRow:{fontSize:12,lineHeight:"18px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},name:{fontSize:14,lineHeight:"22px"},listItemAction:{margin:0,button:{height:32,padding:"0 5px",width:32}}}});var eO=r(2921),eW=r.n(eO);let eL=e=>{let{item:t,onDelete:r,testIdPrefix:i}=e,{api:n}=(0,eN.N)(),{classes:s,cx:o}=eG({threeColumned:!!r}),l=(0,d.useCallback)(async()=>{"external"===t.type?ew((await n.getDownloadMediaLink(t.id)).uri,t.name):ew(t.src,t.name)},[n,t]);return(0,a.jsxs)("div",{className:o(s.listItem,"list-view-item"),...N("".concat(i,"-").concat(t.id,"-media-list-view-item")),children:["photo"===t.variant&&(0,a.jsx)("div",{className:s.listItemVariantImage,style:function(e){return{height:Math.max(40,Math.min(Math.round(40/(e.width/e.height)),100)),width:40}}(t),...N("".concat(i,"-").concat(t.id,"-media-list-view-item-image")),children:(0,a.jsx)(eB,{id:t.id,name:t.name,src:t.src,type:t.type})}),"file"===t.variant&&(0,a.jsx)(eo.$,{className:o(s.listItemVariantFile,"media-list-item-variant-file"),onClick:l,...N("".concat(i,"-").concat(t.id,"-media-list-view-item-file")),children:(0,a.jsx)(M.g6N,{})}),(0,a.jsxs)("div",{className:o(s.listItemInfo,"media-list-item-info"),children:[(0,a.jsx)("div",{className:o(s.listItemInfoRow,s.name),children:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.length<24?t:"".concat(t.substring(0,24),"...").concat(null==(e=t.split("."))?void 0:e.at(-1))}(t.name||"-")}),(0,a.jsx)("div",{className:s.listItemInfoRow,children:function(e){var t;return null!=(t=eW()(e||0,{unitSeparator:" "}))?t:""}(t.size)})]}),!!r&&(0,a.jsx)("div",{className:s.listItemAction,children:(0,a.jsx)(eo.$,{onClick:()=>r(t.id),size:"xs",variant:"subtle",children:(0,a.jsx)(M.Eau,{size:20})})})]})},e$=(0,d.memo)(e=>{let{items:t,onItemDelete:r,testIdPrefix:i}=e,{classes:n,cx:s}=eH();return(0,a.jsx)(eF.B,{className:s(n.list,"list-view"),spacing:"sm",...N("".concat(i,"-media-list-view")),children:t.map(e=>(0,a.jsx)(eF.B.Item,{className:"list-view-item-container",children:(0,a.jsx)(eL,{item:e,onDelete:r,testIdPrefix:i})},e.id))})});function eV(e){return eI(e)?{...function(e){var t;let r=null==(t=e.attributes)?void 0:t.find(e=>"DocumentAttributeImage"===e.$type);return r?{height:r.height,width:r.width}:ek}(e),id:e.id,name:eC(e),size:e.size,src:e.src||function(e){var t;let r=null==(t=e.thumbs)?void 0:t.find(e=>"ImageStrippedSize"===e.$type);return(null==r?void 0:r.bytes)&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/jpeg";return"".concat(t?"":"data:".concat(r,";base64,")).concat(e)}(r.bytes)}(e)||"",type:e.src?"internal":"external",variant:"photo"}:{height:0,id:e.id,name:eC(e),size:e.size,src:e.src||"",type:e.src?"internal":"external",variant:"file",width:0}}e$.displayName="MediaListView";var eX=r(83004);let eU=(0,eX.i7)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(360deg)"}}),eY=(0,S.r)(e=>({root:{display:"inline",maxHeight:"400px",overflowY:"auto",overflowX:"hidden",position:"relative"},ringProgress:{".mantine-RingProgress-root, .mantine-rtl-RingProgress-root":{backgroundColor:e.colors.gray[9],left:"50%",position:"absolute",top:"50%",transform:"translate(-50%, -50%)",zIndex:1},".mantine-RingProgress-root > svg, .mantine-rtl-RingProgress-root > svg":{animation:"".concat(eU," 2s linear infinite")},".mantine-ActionIcon-root, .mantine-rtl-ActionIcon-root":{color:e.white}}}));var eJ=r(49914),eq=r(58393);let eZ=(0,eX.i7)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(360deg)"}}),eK=(0,S.r)(e=>({root:{background:"light"===e.colorScheme?"rgba(0, 0, 0, .5)":e.colors[e.primaryColor][6],borderRadius:"50%","> svg":{animation:"".concat(eZ," 2s linear infinite")},"circle:first-of-type":{stroke:"transparent"}},icon:{color:e.white}})),eQ=e=>{let{onIconClick:t,progress:r}=e,{classes:i}=eK();return(0,a.jsx)(eJ.W,{classNames:{root:i.root},roundCaps:!0,sections:[{value:r,color:"white"}],size:44,thickness:2,label:(0,a.jsx)(eq.o,{children:(0,a.jsx)(I.M,{className:i.icon,size:28,onClick:t,variant:"transparent",children:(0,a.jsx)(M.MRt,{})})})})},e0=(0,d.memo)(e=>{let{containerMaxWidth:t,mediaDocuments:r=[],mediaUpload:i,onMediaDocumentDelete:n,testIdPrefix:s}=e,{classes:o}=eY(),l=(0,d.useMemo)(()=>r.every(eI),[r]),c=(0,d.useMemo)(()=>r.map(eV),[r]);return c.length?(0,a.jsxs)("div",{className:o.root,children:[l&&(0,a.jsx)(eP,{containerMaxWidth:t,items:c,onItemDelete:n,testIdPrefix:s}),!l&&(0,a.jsx)(e$,{items:c,onItemDelete:n,testIdPrefix:s}),(null==i?void 0:i.progress)!==void 0&&(0,a.jsx)("div",{className:o.ringProgress,...N("media-loader"),children:(0,a.jsx)(eQ,{onIconClick:i.cancel,progress:i.progress})})]}):null});e0.displayName="WidgetMedia";let e1=(0,S.r)(()=>({root:{borderRadius:10,overflow:"hidden",position:"absolute"},overlay:{inset:25,position:"absolute"},modal:{borderRadius:10,width:A.Jc.WIDTH}})),e2=(0,S.r)(e=>({root:{".mantine-RingProgress-root, .mantine-rtl-RingProgress-root":{background:"dark"===e.colorScheme?e.colors[e.primaryColor][8]:e.colors[e.primaryColor][6]},"circle:first-of-type":{stroke:"dark"===e.colorScheme?e.colors[e.primaryColor][8]:e.colors[e.primaryColor][6]},".mantine-ActionIcon-root, .mantine-rtl-ActionIcon-root":{color:e.white}},submitButton:{pointerEvents:"auto !important"},textarea:{marginTop:20},tooltip:{textAlign:"center"}}));var e4=r(90352),e5=r(75342);function e3(){return{documents:[],files:new Map}}async function e6(e){let t=URL.createObjectURL(e),r={$type:"MediaDocument",attributes:[{$type:"DocumentAttributeFileName",name:e.name}],id:(0,e4.A)(),mimeType:e.type,size:e.size,src:t,thumbs:[]};if(A.RJ.has(e.type)){let e=await (0,e5.N)(t);if(e){var a;null==(a=r.attributes)||a.push({$type:"DocumentAttributeImage",width:e.width,height:e.height})}}return r}let e7=(0,d.memo)(e=>{let{blocked:t,comment:r,files:i,maxFiles:n,onCancel:s,onFilesChange:o,open:l,sendMessage:c,slowMode:u}=e,[m]=(0,H.Bd)(),p=e1(),g=e2(),f=(0,d.useRef)(null),[h,x]=(0,d.useState)(""),[v,b]=(0,d.useState)(e3()),[y,j]=(0,d.useState)(""),k=eb({interval:1e3,slowMode:u}),w=(0,d.useCallback)(e=>{let t=e.target.value;t.trim().length<A.N$.MAX?x(""):x(m("Описание должно быть не более {{max}} символов",{max:A.N$.MAX})),j(t)},[m]),C=(0,d.useCallback)(e=>o(i.concat(e)),[i,o]),I=(0,d.useCallback)(e=>{o(Array.from(v.files.entries()).flatMap(t=>{let[r,a]=t;return r===e?[]:[a]}))},[v.files,o]),M=(0,d.useCallback)(e=>{e.preventDefault(),h||c(y)},[h,c,y]);return(0,d.useEffect)(()=>{if(!i.length)return b(e3());!async function(){b((await Promise.all(i.map(e6))).reduce((e,t,r)=>(e.documents.push(t),e.files.set(t.id,i[r]),e),e3()))}()},[i]),(0,d.useEffect)(()=>{l?j(r):r&&j("")},[r,l]),(0,d.useEffect)(()=>{l&&setTimeout(()=>{var e,t;null==(e=f.current)||e.focus(),null==(t=f.current)||t.setSelectionRange(r.length,r.length)},10)},[l]),(0,a.jsx)(Y.a,{centered:!0,classNames:p.classes,closeButtonLabel:m("Отменить"),onClose:s,opened:l,withCloseButton:!1,...N("add-media-modal"),children:(0,a.jsx)(eh,{disabled:!1,inModal:!0,maxFiles:n,onDrop:C,children:(0,a.jsxs)("form",{className:g.classes.root,name:"add-media-modal-form",onSubmit:M,children:[(0,a.jsx)(e0,{containerMaxWidth:A.Jc.CONTENT_WIDTH,mediaDocuments:v.documents,onMediaDocumentDelete:I,testIdPrefix:"add-media-modal"}),(0,a.jsx)(ex.T,{autosize:!0,className:g.classes.textarea,error:h,maxRows:2,minRows:2,onChange:w,placeholder:(null==k?void 0:k.formatted)||m("Описание"),ref:f,size:"sm",value:y,...N("add-media-modal-message-textarea")}),(0,a.jsxs)(es.Y,{position:"right",mt:"xs",children:[(0,a.jsx)(eo.$,{loading:!1,onClick:s,size:"xs",variant:"outline",...N("add-media-modal-cancel-button"),children:m("Отменить")}),(0,a.jsx)(et.m,{className:g.classes.tooltip,disabled:u.active,label:m("Вы сможете отправить сообщение через {{time}}",{time:null==k?void 0:k.formatted}),multiline:!0,withArrow:!0,w:170,...N("add-media-modal-slowmode-tooltip"),children:(0,a.jsx)(eo.$,{className:g.classes.submitButton,disabled:t||u.active,size:"xs",type:"submit",...N("add-media-modal-send-button"),children:m("Отправить")})})]})]})})})});e7.displayName="WidgetMediaModal";let e9={"&.enter":{opacity:0},"&.enter-active":{opacity:1,transition:"opacity 200ms"},"&.exit":{opacity:1},"&.exit-active":{opacity:0,transition:"opacity 200ms"}},e8={"&.enter":{opacity:0,transform:"scale(0.9)"},"&.enter-active":{opacity:1,transform:"translateX(0)",transition:"opacity 200ms, transform 200ms"},"&.exit":{opacity:1},"&.exit-active":{opacity:0,transform:"scale(0.9)",transition:"opacity 200ms, transform 200ms"}},te=(0,S.r)((e,t)=>{let{isMobile:r}=t;return{root:{backgroundColor:"dark"===e.colorScheme?e.colors.dark[7]:e.white,display:"flex",flexDirection:"column",height:"100%",maxHeight:r?"100%":A.P5,maxWidth:r?"100%":A.Uq,minHeight:0,minWidth:0,position:"relative",width:"100%",...r?e9:e8,...!r&&{borderRadius:10,boxShadow:"4px 0 24px rgba(0, 0, 0, .12)"}},header:{borderBottom:"1px solid ".concat("dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]),flex:"none"},body:{display:"flex",flex:1,flexDirection:"column",minHeight:0},footer:{borderTop:"1px solid ".concat("dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]),flex:"none"}}}),tt=e=>{let{body:t,header:r,footer:i,isMobile:n}=e,{classes:s}=te({isMobile:n});return(0,a.jsxs)("div",{className:s.root,children:[(0,a.jsx)("div",{className:s.header,children:r}),(0,a.jsx)("div",{className:s.body,children:t}),!!i&&(0,a.jsx)("div",{className:s.footer,children:i})]})};var tr=r(24802),ta=r(95816),ti=r.n(ta),tn=r(7296),ts=r.n(tn);let to=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return ts()(e,(e,r)=>{let a=r;return("string"==typeof r&&(a=r.trim()),["string","object","array","undefined","null"].includes(typeof a)&&t&&ti()(a))?tn.mapObjectSkip:[e,a]},{deep:!0})};var tl=r(49693),tc=r(80060),td=r(831),tu=r.n(td),tm=r(82626),tp=r(60729);let tg=e=>(0,tp.Ds)({styles:e=>({root:{backgroundColor:e.colors.red[0],"&::before":{backgroundColor:e.colors.red[5]},borderRadius:"8px",width:"350px",margin:"auto 10px 10px auto"},title:{color:e.colors.red},description:{color:e.colors.red[5]},closeButton:{color:e.colors.gray[6],"&:hover":{color:e.colors.gray[7]}}}),...e});var tf=r(42542);async function th(e){let{files:t,settings:r}=e,a=await Promise.allSettled([tx(t,r.maxFiles),...t.map(e=>tb(e,r.restrictions))]),i=[],n=[];return a.forEach(e=>{"fulfilled"===e.status&&e.value?n.push(e.value):"rejected"===e.status&&i.push(e.reason)}),i.length?{errors:i}:{files:n}}async function tx(e,t){if(e.length>t)return Promise.reject({code:"too-many-files",details:{maxCount:t}})}let tv={"application/rtf":{"application/msword":"application/rtf","application/rtf":"application/rtf","text/rtf":"application/rtf"},"application/vnd.ms-excel.sheet.macroEnabled.12":{"application/vnd.ms-excel.sheet.macroEnabled.12":"application/vnd.ms-excel.sheet.macroenabled.12","application/vnd.ms-excel.sheet.macroenabled.12":"application/vnd.ms-excel.sheet.macroenabled.12"},"application/xml":{"image/svg+xml":"image/svg+xml"},"application/x-7z-compressed":{"application/octet-stream":"application/x-7z-compressed","application/x-7z-compressed":"application/x-7z-compressed","application/x-compressed":"application/x-7z-compressed"},"application/x-rar-compressed":{"application/octet-stream":"application/x-rar-compressed","application/vnd.rar":"application/x-rar-compressed","application/x-compressed":"application/x-rar-compressed","application/x-rar-compressed":"application/x-rar-compressed"},"application/zip":{"application/octet-stream":"application/zip","application/vnd.android.package-archive":"application/vnd.android.package-archive","application/x-zip-compressed":"application/zip","application/zip":"application/zip"},"image/gif":{"image/gif":"image/gif","image/jpeg":"image/gif","image/png":"image/gif"},"image/jpeg":{"image/gif":"image/jpeg","image/jpeg":"image/jpeg","image/png":"image/jpeg"},"image/png":{"image/gif":"image/png","image/jpeg":"image/png","image/png":"image/png"},"image/heif":{"image/heic":"image/heic","image/heif":"image/heic","image/png":"image/heic"},"video/vnd.avi":{"video/avi":"video/avi"},"video/x-ms-asf":{"video/x-ms-asf":"video/x-ms-wmv","video/x-ms-wmv":"video/x-ms-wmv"}};async function tb(e,t){var r;let a=e.stream(),i=await (0,tf.Tm)(a)||("text/plain"===(r=e).type?{ext:"txt",mime:"text/plain"}:"image/svg+xml"===r.type?{ext:"svg",mime:"image/svg+xml"}:void 0);if(!i)return Promise.reject({code:"invalid-file-format",details:{fileType:e.type}});let n=i.mime,s=function(e){var t;if(e.type)return e.type;switch(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase()){case"7z":return"application/x-7z-compressed";case"rar":return"application/x-rar-compressed";case"xlsm":return"application/vnd.ms-excel.sheet.macroEnabled.12";case"heic":return"image/heic";default:return"application/octet-stream"}}(e),o=n,l=tv[n];if(null==l?void 0:l[s])o=l[s];else if(n!==s)return Promise.reject({code:"invalid-file-contents"});let c=t.find(e=>{let{contentType:t}=e;return t===o});return c?e.size>c.lengthLimit?Promise.reject({code:"file-too-large",details:{fileType:c.contentType,maxSize:c.lengthLimit}}):new File([e],e.name,{type:o}):Promise.reject({code:"invalid-file-format",details:{fileType:o}})}let ty={comment:"",files:[]};var tj=r(925),tk=r.n(tj);function tw(){return{$type:"ChatParticipantMessage",createdAt:0,deleted:!0,fromId:"",id:Math.random()}}function tC(){return{listeners:new Set,message:void 0}}async function tI(e){let t=Number(await e.get(A.Zv.messageSoundActive));return isNaN(t)||![0,1].includes(t)?null:t}async function tM(e,t){await e.set(A.Zv.messageSoundActive,String(t),A.Es)}var tN=r(56266),tS=r(31008),tR=r(26993);let tA=(0,S.r)(e=>{let t="dark"===e.colorScheme?e.colors.gray[8]:e.white,r="dark"===e.colorScheme?e.colors.gray[7]:e.colors.gray[0],a="dark"===e.colorScheme?e.colors.gray[7]:e.colors.gray[6],i="dark"===e.colorScheme?e.colors.gray[4]:e.colors.gray[7];return{container:{bottom:10,height:36,position:"absolute",right:20,width:36},content:{position:"relative",button:{backgroundColor:t,borderRadius:"50%",boxShadow:"0 2px 3px ".concat(a),color:i,height:36,width:36,"&:before":{borderRadius:"50% !important"},"&:hover":{backgroundColor:r}}},loader:{position:"absolute",transform:"translate(-2.5px, -2.5px)"}}}),tT=(0,d.forwardRef)((e,t)=>{let{onClick:r}=e,[i,n]=(0,d.useState)(!1),[s,o]=(0,d.useState)(!1),[l,c]=(0,d.useState)(0),{classes:u}=tA();return(0,d.useImperativeHandle)(t,()=>({setLoading:n,setShow:o,setUnreadCount:c}),[]),(0,a.jsx)(tR.e,{mounted:s,transition:"fade",children:e=>(0,a.jsx)("div",{className:u.container,style:e,children:(0,a.jsx)("div",{className:u.content,children:(0,a.jsxs)(C.C,{disabled:!l,inline:!0,label:l,overflowCount:99,size:22,style:{transform:"translateX(-4px)"},children:[i&&(0,a.jsx)(tN.a,{className:u.loader,size:42}),(0,a.jsx)(I.M,{disabled:i,onClick:r,...N("go-to-the-end-button"),children:(0,a.jsx)(M.RGe,{})})]})})})})});function tz(e){return E().unix(e.createdAt).format("DD MMMM")}tT.displayName="BackToBottom";let tB=(0,S.r)((e,t)=>({root:{display:"flex",fontSize:e.fontSizes.sm,justifyContent:"center",lineHeight:"20px",height:"30px",margin:"0 auto 10px",maxWidth:"calc(100% - 40px)",padding:"4px 10px",position:"relative",textAlign:"center",whiteSpace:"pre-wrap",width:"100%",wordBreak:"break-word",...t.block&&{display:"block"},..."filled"===t.view&&{background:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[2],borderRadius:"0.875rem",color:e.colors.green}}})),tD=(0,d.memo)(e=>{let[t]=(0,H.Bd)(),r=(0,d.useMemo)(()=>"message"in e?"Date"===e.message.type?{block:!1,text:tz(e.message),viewType:"base"}:{block:!0,text:t("Непрочитанные сообщения"),viewType:"filled"}:e,[t,e]),{classes:i}=tB({block:r.block,view:r.viewType});return(0,a.jsx)("div",{className:i.root,suppressHydrationWarning:!0,children:r.text})});tD.displayName="WidgetClientMessage";var tE=r(88728),t_=r(24890),tP=r.n(t_);let tF=["red","pink","grape","violet","indigo","blue","cyan","green","lime","yellow","orange","teal"],tH=(0,S.r)(()=>({root:{".mantine-Avatar-placeholder, .mantine-rtl-Avatar-placeholder":{fontWeight:500}}})),tG=e=>{let{testIdPrefix:t,user:r}=e,{classes:i}=tH(),n=(0,d.useMemo)(()=>{if(r.id){let e=Math.abs(tP()(r.id).int32())%tF.length;return tF[e]}},[r.id]);return"Client"===r.$type?null:"OperatorBot"===r.$type?(0,a.jsx)(tE.e,{className:i.root,color:n,radius:"xl",size:42,...N("".concat(t,"-").concat(r.id,"-bot-avatar")),children:(0,a.jsx)(M.OW7,{size:24})}):r.avatarLink?(0,a.jsx)(tE.e,{className:i.root,radius:"xl",size:42,src:r.avatarLink,...N("".concat(t,"-").concat(r.id,"-image-avatar"))}):(0,a.jsx)(tE.e,{className:i.root,color:n,radius:"xl",size:42,...N("".concat(t,"-").concat(r.id,"-text-avatar")),children:r.name.slice(0,2).toLocaleUpperCase()})},tO={MAX_WIDTH:320,AVATAR_WIDTH:42,AVATAR_AND_CONTENT_GAP:10,PADDING_X:6,PADDING_Y:6},tW={CLIENT:tO.MAX_WIDTH-2*tO.PADDING_X,OPERATOR:tO.MAX_WIDTH-tO.AVATAR_WIDTH-tO.AVATAR_AND_CONTENT_GAP-2*tO.PADDING_X},tL=(0,S.r)((e,t)=>({container:{display:"flex",flexDirection:"column",margin:"0 auto",marginBottom:2,maxWidth:"calc(100% - 40px)",position:"relative",width:"100%",...t.isLastInGroup&&{marginBottom:10}},content:{alignItems:"flex-end",display:"flex",gap:tO.AVATAR_AND_CONTENT_GAP,maxWidth:tO.MAX_WIDTH,...t.isMe&&{alignSelf:"flex-end",flexFlow:"row-reverse"}},messageBlock:{display:"flex",flexDirection:"column",minWidth:70,position:"relative"},messageContent:{background:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[2],borderRadius:10,borderBottomLeftRadius:0,display:"inline-block",position:"relative",padding:"".concat(tO.PADDING_Y,"px ").concat(tO.PADDING_X,"px"),...t.isMe&&{background:"dark"===e.colorScheme?e.colors[e.primaryColor][8]:e.colors[e.primaryColor][6],borderBottomLeftRadius:10,borderBottomRightRadius:0,color:"white",".mantine-List-root":{padding:4},".media-list-item-variant-file, .media-list-item-variant-file:hover":{background:e.white,color:e.colors.gray[6]},".media-list-item-variant-file:hover":{opacity:.9},".media-list-item-info":{color:e.white}}}})),t$=(0,S.r)(()=>({avatar:{flex:"none",position:"relative",width:tO.AVATAR_WIDTH,"> div":{bottom:0,position:"absolute"}}})),tV=(0,S.r)(e=>({footer:{alignItems:"center",display:"flex",float:"right",gap:4,height:18,justifySelf:"flex-end",marginInlineStart:8,transform:"translateY(3px)",userSelect:"none",span:{display:"flex",fontSize:e.fontSizes.sm}}})),tX=(0,S.r)(e=>{let t=e.colors.dark[3],r=e.colors.gray[6];return{header:{color:"dark"===e.colorScheme?t:r,fontSize:e.fontSizes.sm,lineHeight:"20px",marginBottom:2}}}),tU=(0,S.r)(()=>({markupButtons:{marginInlineStart:52,marginTop:8}})),tY=(0,S.r)(e=>({markupRows:{color:e.colors[e.primaryColor][8]},markupRow:{fontSize:e.fontSizes.md,lineHeight:"24px",padding:"0 0 8px 20px",position:"relative","&:before":{content:"'•'",fontSize:26,left:0,position:"absolute",top:-2},"&:last-of-type":{paddingBottom:0}}})),tJ=(0,S.r)(e=>({reserved:{borderLeft:"2px solid ".concat(e.colors.primary[6]),height:40,margin:4,width:1},container:{alignItems:"center",borderLeft:"2px solid ".concat(e.colors.primary[6]),cursor:"pointer",display:"flex",fontSize:12,margin:4},image:{boxSizing:"border-box",height:32,marginLeft:8,minWidth:32,width:32,"> div":{borderRadius:2}},details:{marginLeft:5,overflow:"hidden"},username:{lineHeight:"20px"},text:{color:"#797d88",lineHeight:"20px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),tq=(0,S.r)((e,t)=>({container:{padding:"0 4px",whiteSpace:"pre-wrap",wordBreak:"break-word"},content:{fontSize:e.fontSizes.md,lineHeight:"24px",marginBlockEnd:"0 !important","*:first-of-type":{marginBlockStart:"0 !important"},"*:last-child":{marginBlockEnd:"0 !important"},"> p:last-child":{display:"inline-block"},a:{color:t?e.colors.gray[3]:e.colors.green[7],textDecoration:"underline","&:hover":{color:t?e.colors.gray[4]:e.colors.green[6]}}}})),tZ=e=>{let{author:t,isLastInGroup:r,isMe:i,messageId:n}=e,{classes:s}=t$();return i?null:(0,a.jsx)("div",{className:s.avatar,children:r&&(0,a.jsx)(tG,{testIdPrefix:"".concat(n,"-message"),user:t})})},tK=e=>{let{isMe:t,isMessageReadSub:r,message:i}=e,{classes:n}=tV(),s=E().unix(i.createdAt),[o,l]=(0,d.useState)(()=>!!t&&r.getInitialValue(i.id));return(0,d.useEffect)(()=>(t&&r.subscribe(i.id,l),function(){t&&r.unsubscribe(i.id)}),[t,r,i.id]),(0,a.jsxs)("div",{className:n.footer,children:["sending"===i.sendStatus&&(0,a.jsx)("span",{children:(0,a.jsx)(M._Ll,{size:14})}),"sending"!==i.sendStatus&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{suppressHydrationWarning:!0,title:s.format("D MMMM YYYY, HH:mm:ss"),children:s.format("HH:mm")}),t&&(0,a.jsx)("span",{children:o?(0,a.jsx)(M.Zy7,{size:16}):(0,a.jsx)(M.iWP,{size:16})})]})]})};function tQ(e,t){if(e){if("Client"===e.$type)return t("Вы");if("OperatorBot"===e.$type)return e.name||t("Ассистент");if("Operator"===e.$type)return e.name}}function t0(e){var t,r;let{__:a,replyMessage:i,users:n}=e,s=t2(t=i)?t.replyToUserId:t.fromId;return{id:t2(r=i)?r.replyToMessageId:r.id,mediaInfo:t1(i.medias),text:function(e,t){var r;let a=t1(e.medias),i=e.text||"";return(r=e)&&"$type"in r&&"ChatParticipantMessage"===r.$type&&e.deleted?t("Сообщение удалено"):(null==a?void 0:a.isImage)?i||t("Изображение"):[null==a?void 0:a.name,i].filter(Boolean).join(" ")}(i,a),username:tQ(n[s],a)}}function t1(e){if(!(null==e?void 0:e.length))return null;let t=e[0],r=t.attributes.find(e=>"DocumentAttributeFileName"===e.$type);return{id:t.id,isImage:A.RJ.has(t.mimeType),name:(null==r?void 0:r.name)||""}}function t2(e){return!!e&&"replyToUserId"in e}let t4=e=>{let{author:t,isFirstInGroup:r,isMe:i}=e,[n]=(0,H.Bd)(),{classes:s}=tX(),o=tQ(t,n);return!i&&o&&r?(0,a.jsx)("div",{className:s.header,children:o}):null},t5=e=>{var t,r;let{message:i,onClick:n}=e,{classes:s}=tU();if(!(null==(r=i.replyMarkup)||null==(t=r.buttons)?void 0:t.length))return null;let o=e=>()=>{"ButtonVariant"===e.$type&&n(e)};return(0,a.jsx)(es.Y,{className:s.markupButtons,spacing:6,...N("".concat(i.id,"-message-markup-buttons")),children:i.replyMarkup.buttons.map(e=>(0,a.jsx)(eo.$,{compact:!0,radius:"md",variant:"outline",onClick:o(e),...N("".concat(i.id,"-message-").concat(e.text,"-markup-button")),children:(0,a.jsx)("span",{children:e.text})},e.id))})},t3=e=>{let{messageId:t,onClick:r,rows:i}=e,{classes:n}=tY(),s=e=>{if("RowVariant"===e.$type)return"link"},o=e=>()=>{"RowVariant"===e.$type&&r(e)};return(null==i?void 0:i.length)?(0,a.jsx)("div",{className:n.markupRows,...N("".concat(t,"-message-markup-rows")),children:i.map(e=>(0,a.jsx)("div",{className:n.markupRow,children:(0,a.jsx)(G.E,{component:"span",onClick:o(e),variant:s(e),...N("".concat(t,"-message-").concat(e.text,"-markup-row")),children:e.text})},e.id))}):null},t6=e=>{let{isMe:t,medias:r,messageId:i}=e,n=(0,u.G)(e=>(0,y.LA)(e)[i]);return(0,a.jsx)(e0,{containerMaxWidth:t?tW.CLIENT:tW.OPERATOR,mediaDocuments:r,mediaUpload:n,testIdPrefix:"".concat(i,"-message")})},t7=e=>{var t;return(null==(t=e.author)?void 0:t.$type)==="OperatorBot"?null:e.message.messageReplyHeader?(0,a.jsx)(t9,{onClick:e.onClick,parentMessageId:e.message.id,replyHeader:e.message.messageReplyHeader,users:e.users}):"number"==typeof e.message.replyMessageId?(0,a.jsx)(t8,{messageSubscription:e.messageSubscription,onClick:e.onClick,parentMessageId:e.message.id,replyId:e.message.replyMessageId,users:e.users}):null},t9=e=>{let{onClick:t,parentMessageId:r,replyHeader:i,users:n}=e,[s]=(0,H.Bd)();return(0,a.jsx)(re,{parentId:r,replyMessageMetadata:t0({__:s,replyMessage:i,users:n}),onClick:t})},t8=e=>{let{messageSubscription:t,onClick:r,parentMessageId:i,replyId:n,users:s}=e,{classes:o}=tJ(),[l]=(0,H.Bd)(),c=(0,eM.A)(),[u,m]=(0,d.useState)(()=>t.getByIdFromCache(n));return((0,d.useEffect)(()=>{let e=e=>{c.current||m(e)};return t.subscribe(n,e),()=>t.unsubscribe(n,e)},[t,n,c]),u)?(0,a.jsx)(re,{parentId:i,replyMessageMetadata:t0({__:l,replyMessage:u,users:s}),onClick:r}):(0,a.jsx)("div",{className:o.reserved})},re=e=>{var t;let{parentId:r,replyMessageMetadata:i,onClick:n}=e,{classes:s}=tJ(),o=(0,d.useCallback)(()=>n(i.id),[n,i.id]),l=(0,d.useCallback)(e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o())},[o]);return(0,a.jsxs)("div",{className:s.container,onClick:o,onKeyDown:l,role:"button",tabIndex:0,...N("".concat(r,"_message-reply")),children:[!!(null==(t=i.mediaInfo)?void 0:t.isImage)&&(0,a.jsx)("div",{className:s.image,...N("".concat(r,"_message-reply-image")),children:(0,a.jsx)(eB,{id:i.mediaInfo.id,name:i.mediaInfo.name,noActions:!0,src:"",type:"external"})}),(0,a.jsxs)("div",{className:s.details,children:[(0,a.jsx)("div",{className:s.username,...N("".concat(r,"_message-reply-author")),children:i.username}),(0,a.jsx)("div",{className:s.text,...N("".concat(r,"_message-reply-text")),children:i.text})]})]})},rt=e=>{let{footer:t,isMe:r,message:i,rows:n}=e,{classes:s}=tq(r),o=(0,d.useMemo)(()=>{var e;return(null==(e=i.text)?void 0:e.replace(/^(\d{4,})\.(?=\s|$)/gm,"$1"))||""},[i.text]);return(0,a.jsxs)("div",{className:s.container,children:[(0,a.jsxs)("span",{className:s.content,children:[!!o&&(0,a.jsx)(F.oz,{allowedConstructs:r?[]:void 0,children:o}),!o&&(0,a.jsx)(a.Fragment,{children:i.text}),n]}),t]})},rr=(0,d.memo)(e=>{var t,r;let{client:i,isMessageReadSub:n,message:s,messageSubscription:o,nextMessage:l,onReplyClick:c,onSendMarkupVariant:d,prevMessage:u,users:m}=e,p=m[s.fromId],g=function(e){let{message:t,prevMessage:r}=e;return(null==r?void 0:r.$type)!=="ChatParticipantMessage"||r.fromId!==t.fromId}({message:s,prevMessage:u}),f=function(e){let{message:t,nextMessage:r}=e;return(null==r?void 0:r.$type)!=="ChatParticipantMessage"||r.fromId!==t.fromId}({message:s,nextMessage:l}),h=function(e){let{client:t,message:r}=e;return r.fromId===(null==t?void 0:t.id)}({client:i,message:s}),{classes:x}=tL({isLastInGroup:f,isMe:h});return(0,a.jsxs)("div",{className:x.container,children:[(0,a.jsxs)("div",{className:x.content,children:[(0,a.jsx)(tZ,{author:p,isLastInGroup:f,isMe:h,messageId:s.id}),(0,a.jsxs)("div",{className:x.messageBlock,...N("".concat(s.id,"-message-content-block")),children:[(0,a.jsx)(t4,{author:p,isFirstInGroup:g,isMe:h}),(0,a.jsxs)("div",{className:x.messageContent,children:[(0,a.jsx)(t7,{author:p,message:s,messageSubscription:o,onClick:c,users:m}),!!(null==(t=s.medias)?void 0:t.length)&&(0,a.jsx)(t6,{isMe:h,medias:s.medias,messageId:s.id}),(0,a.jsx)(rt,{footer:(0,a.jsx)(tK,{isMe:h,isMessageReadSub:n,message:s}),isMe:h,message:s,rows:(0,a.jsx)(t3,{messageId:s.id,onClick:d,rows:null==(r=s.replyMarkup)?void 0:r.rows})})]})]})]}),(0,a.jsx)(t5,{message:s,onClick:d})]})});rr.displayName="WidgetParticipantMessage";let ra=(0,S.r)(e=>({root:{display:"flex",fontSize:e.fontSizes.sm,justifyContent:"center",lineHeight:"20px",margin:"0 auto 10px",maxWidth:"calc(100% - 40px)",padding:"4px 0",position:"relative",textAlign:"center",whiteSpace:"pre-wrap",width:"fit-content",wordBreak:"break-word"}})),ri=(0,d.memo)(e=>{let{message:t,users:r}=e,[i]=(0,H.Bd)(),{classes:n}=ra();return(0,a.jsx)("div",{className:n.root,"data-message-id":t.id,suppressHydrationWarning:!0,children:function(e){let{action:t}=e.message;switch(t.$type){case"LongOperatorSearch":return r=t,({High:"",Low:(a=e).__("В настоящее время все сотрудники заняты, пожалуйста, ожидайте, вам ответит первый освободившийся оператор."),Medium:a.__("К сожалению, мы не успеваем ответить всем нашим клиентам в короткие сроки. Пожалуйста, ожидайте, мы работаем над тем, чтобы в ближайшее время вам ответил первый освободившийся оператор.")})[r.time]||"";case"OperatorAddedAction":return i=0,e.__("В чат добавлен оператор");case"OperatorInvokeFailedAction":return n=t,({NoOnline:(s=e).__("Пожалуйста, воспользуйтесь альтернативными каналами поддержки или попробуйте найти ответ самостоятельно, написав сообщение боту или на сайте."),Timeout:s.__("К сожалению, мы не успеваем ответить всем нашим клиентам. Пожалуйста, попробуйте обратиться позднее или воспользуйтесь альтернативными каналами поддержки или попробуйте найти ответ самостоятельно, написав сообщение боту или на сайте.")})[n.reason]||"";case"OperatorInvokedAction":return o=0,e.__("Переключаем ваш диалог на оператора. Мы уже занимаемся вашим вопросом, ответим в ближайшее время.");case"OperatorSetBanAction":var r,a,i,n,s,o,l=t,c=e;let d=c.users[l.userId],u=[c.__("Клиент забанен оператором {{operator}}",{operator:(null==d?void 0:d.$type)==="Operator"?d.name:"Unknown"})];return l.reason&&u.push(c.__('Причина: "{{reason}}"',{reason:l.reason})),u.push(c.__("Длительность бана: {{duration}}",{duration:l.timeSeconds})),u.join(". ").concat(".");default:return"Unknown service message"}}({__:i,message:t,users:r})})});ri.displayName="ServiceMessage";let rn=(0,d.memo)(e=>{let{client:t,id:r,index:i,isMessageReadSub:n,message:s,messageSubscription:o,nextMessage:l,onRef:c,onReplyClick:d,onSendMarkupVariant:u,prevMessage:m,users:p}=e;return(0,a.jsxs)("div",{"data-date":tz(s),"data-id":r,"data-index":i,ref:e=>c(s,e),...N("".concat(r,"-chat-message")),children:[(null==s?void 0:s.$type)==="ChatClientMessage"&&(0,a.jsx)(tD,{message:s}),(null==s?void 0:s.$type)==="ChatParticipantMessage"&&(0,a.jsx)(rr,{client:t,isMessageReadSub:n,message:s,messageSubscription:o,nextMessage:l,onReplyClick:d,onSendMarkupVariant:u,prevMessage:m,users:p}),(null==s?void 0:s.$type)==="ChatSystemMessage"&&(0,a.jsx)(ri,{message:s,users:p})]})});rn.displayName="WidgetBodyItem";let rs={HEIGHT:30,OFFSET_Y:8,TOTAL_HEIGHT:46},ro=(0,S.r)(e=>({pinnedDate:{height:rs.HEIGHT,margin:"".concat(rs.OFFSET_Y,"px auto"),maxWidth:"calc(100% - 40px)",position:"sticky",top:rs.OFFSET_Y,userSelect:"none",width:"100%",zIndex:1,"> div":{background:"dark"===e.colorScheme?e.colors.dark[7]:e.white,borderRadius:6,width:"fit-content"}}})),rl=(0,d.forwardRef)((e,t)=>{let{initialDate:r}=e,{classes:i}=ro(),[n,s]=(0,d.useState)(r);return(0,d.useImperativeHandle)(t,()=>({setDate:s}),[]),(0,a.jsx)("div",{className:i.pinnedDate,children:(0,a.jsx)(tD,{block:!1,text:n,viewType:"base"})})});rl.displayName="PinnedDate";let rc=rs.TOTAL_HEIGHT,rd=(0,S.r)(e=>({wrapper:{height:"100%",position:"relative",width:"100%"},loader:{alignItems:"center",backgroundColor:"dark"===e.colorScheme?e.colors.dark[7]:e.white,display:"flex",inset:0,justifyContent:"center",position:"absolute",zIndex:2}})),ru=(0,S.r)(()=>({chat:{boxSizing:"border-box",height:"100%",overflowY:"auto",position:"relative"}}));function rm(e){let{onInView:t,rootMargin:r,scrollableRef:a,threshold:i}=e,n=(0,d.useRef)(),s=(0,d.useRef)(new Set),o=(0,d.useRef)(new Map),l=(0,d.useRef)(new Map),c=(0,eS.F)(t),u=(0,d.useCallback)(e=>s.current.has(e),[]),m=(0,d.useCallback)(e=>l.current.get(e),[]),p=(0,d.useCallback)((e,t)=>{t?o.current.set(e,t):o.current.delete(e)},[]),g=(0,d.useCallback)((e,t)=>{if(!n.current)return void p(e,t);let r=l.current.get(e);t?(l.current.set(e,t),n.current.observe(t)):r&&(n.current.unobserve(r),l.current.delete(e),s.current.delete(e))},[p]);return(0,d.useEffect)(()=>(a.current&&!n.current&&(n.current=new IntersectionObserver(e=>{for(let t of e){let e=t.target,r=Number(e.dataset.id);t.isIntersecting?(s.current.add(r),c.current(e,r)):s.current.delete(r)}},{root:a.current,rootMargin:r,threshold:i})),function(){n.current&&(n.current.disconnect(),n.current=void 0)}),[c,r,a,i]),(0,d.useEffect)(()=>{n.current&&o.current.size&&(Array.from(o.current.values()).forEach(e=>{var t;null==(t=n.current)||t.observe(e)}),o.current.clear())},[]),(0,d.useMemo)(()=>({getIsInView:u,getNode:m,observe:g}),[u,m,g])}function rp(e){if(e)return tz(e)}var rg=r(37599);let rf=(0,d.memo)(e=>{var t;let{chat:r,client:i,invokeOperatorShown:n,messageSubscription:s,messages:o,onSendMarkupVariant:l,users:c}=e,{classes:u}=ru(),m=(0,d.useRef)(null),p=function(e){let{chat:t,messages:r}=e,a=(0,d.useRef)({computedOnce:!1,id:void 0});if(!a.current.computedOnce){var i;a.current={computedOnce:!0,id:null==(i=t.unreadMessageIds)?void 0:i[0]}}let n=(0,d.useMemo)(()=>r.reduce((e,t,r,i)=>{var n,s;let{id:o}=t,l=rp(i[r-1]),c=rp(t);return 0===r&&c&&(e.firstMessageDate=c),c&&l&&c!==l&&e.messages.push({$type:"ChatClientMessage",createdAt:(n=t).createdAt,id:n.id+A.d4+1,type:"Date"}),o>1&&o===a.current.id&&e.messages.push({$type:"ChatClientMessage",createdAt:(s=t).createdAt,id:s.id+A.d4+2,type:"Unread"}),e.messages.push(t),e.messageIndexById[o]=e.messages.length-1,e},{firstMessageDate:"",messageIndexById:{},messages:[]}),[r]);return{firstMessageDate:n.firstMessageDate,initialFirstUnreadId:a.current.id,messageIndexById:n.messageIndexById,messages:n.messages}}({chat:r,messages:o}),g=function(e){var t;let{clientId:r,initialFirstUnreadId:a,invokeOperatorShown:i,lastReadId:n,messageIndexById:s,originalMessages:o}=e,[l,c]=(0,d.useState)(!1),u=(0,rg.A)(o),m=(0,d.useRef)(!1),p=(0,d.useRef)({bottom:0,top:0}),g=(0,d.useRef)(!1),f=(0,d.useRef)(null),h=(0,d.useRef)(!1),x=(0,d.useCallback)((e,t)=>{if(f.current){var r,a;f.current.scrollToIndex(e,{align:null!=(r=null==t?void 0:t.align)?r:"start",offset:null!=(a=null==t?void 0:t.offset)?a:-rc,smooth:null==t?void 0:t.smooth})}},[]),v=(0,d.useCallback)(()=>x(1/0,{align:"end",offset:0}),[x]),b=(0,d.useCallback)(e=>{h.current=e},[]),y=(0,d.useCallback)(e=>{if(f.current&&!m.current){let{scrollSize:t,viewportSize:r}=f.current;e-=rc,p.current.bottom=t-r-e,p.current.top=e}return p.current},[]);return t=()=>{f.current&&("number"==typeof a?requestAnimationFrame(()=>{var e;return x((null!=(e=s[a])?e:0)-1)}):"number"==typeof n&&v(),g.current=!0,c(!0))},(0,d.useEffect)(t,[]),(0,d.useLayoutEffect)(()=>{if(!g.current||!(null==u?void 0:u.length))return;let e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!(null==t?void 0:t.length))return!1;let r=e.length,a=t.length,i=e[r-1],n=t[a-1];return r-a==1&&(null==i?void 0:i.id)!==(null==n?void 0:n.id)}(o,u),t=function(e,t){let r=e[e.length-1];return(null==r?void 0:r.$type)==="ChatParticipantMessage"&&r.fromId===t}(o,r),a=p.current.bottom<=50;e&&(t||a)&&v()},[r,o,u,v]),(0,d.useLayoutEffect)(()=>{g.current&&(m.current=!0,setTimeout(()=>{f.current&&(f.current.scrollTo(f.current.scrollSize-f.current.viewportSize-p.current.bottom+rc),m.current=!1)}))},[i]),{ready:l,scrollToIndex:x,setVirtualizerShift:b,trackScrollPosition:y,virtualizerRef:f,virtualizerShift:h.current}}({clientId:null==i?void 0:i.id,initialFirstUnreadId:p.initialFirstUnreadId,invokeOperatorShown:n,lastReadId:r.lastReadInboxMessageId,messageIndexById:p.messageIndexById,originalMessages:o}),f=function(e){let{setVirtualizerShift:t}=e,{loadMore:r}=(0,j.on)(),a=(0,d.useRef)(!1),i=(0,d.useRef)(!1),n=(0,tm.YQ)(e=>r({direction:j.TN.Backwards,...e}),500,{leading:!0,trailing:!1}),s=(0,tm.YQ)(()=>r({direction:j.TN.Forwards}),500,{leading:!0,trailing:!1});return{onScroll:(0,d.useCallback)(async e=>{e.top<=150?i.current||(i.current=!0,await n({onBeforeAddingMessages:()=>t(!0)}),t(!1)):i.current=!1,e.bottom<=150?a.current||(a.current=!0,t(!1),s()):a.current=!1},[n,s,t])}}({setVirtualizerShift:g.setVirtualizerShift}),h=function(e){let{lastReadOutboxMessageId:t}=e,r=(0,eS.F)(t),a=(0,d.useRef)(new Map),i=(0,d.useCallback)(e=>!!r.current&&e<=r.current,[r]),n=(0,d.useCallback)(e=>{a.current.delete(e)},[]),s=(0,d.useCallback)((e,t)=>{i(e)?n(e):a.current.set(e,t)},[i,n]);return(0,d.useEffect)(()=>{Array.from(a.current.entries()).forEach(e=>{let[t,r]=e;i(t)&&(r(!0),n(t))})},[i,t,n]),(0,d.useMemo)(()=>({getInitialValue:i,subscribe:s,unsubscribe:n}),[i,s,n])}({lastReadOutboxMessageId:r.lastReadOutboxMessageId}),x=function(e){let{chatId:t,lastReadId:r,scrollableRef:a}=e,i=(0,j.FW)(),n=(0,d.useRef)(null!=r?r:-1),s=(0,tm.dh)(e=>void i(t,e),500,{leading:!1}),o=rm({onInView:(e,t)=>{!isNaN(t)&&t>n.current&&t<A.d4&&(n.current=t,s(t))},rootMargin:"0px",scrollableRef:a,threshold:.5});return(0,d.useEffect)(()=>{"number"==typeof r&&(n.current=Math.max(n.current,r))},[r]),{observe:o.observe}}({chatId:r.id,lastReadId:r.lastReadInboxMessageId,scrollableRef:m}),v=function(e){let{scrollableRef:t}=e,r=(0,d.useRef)(new Map),a=(0,d.useRef)(new Set),i=rm({onInView:(e,t)=>{a.current.has(t)&&(s(t,e),a.current.delete(t))},rootMargin:"0px",scrollableRef:t,threshold:.01}),n=(0,d.useCallback)(e=>{let t=r.current.get(e);t&&(clearTimeout(t),r.current.delete(e))},[]),s=(0,d.useCallback)((e,t)=>{t.style.setProperty("transition","background ".concat(600,"ms")),t.style.setProperty("transition-delay","".concat(150,"ms")),t.style.setProperty("background","rgba(37, 140, 96, 0.2)"),r.current.set(e,setTimeout(()=>{t.style.removeProperty("background"),r.current.set(e,setTimeout(()=>{t.style.removeProperty("transition"),t.style.removeProperty("transition-delay")},600))},750))},[]);return{highlight:(0,d.useCallback)(e=>{n(e),i.getIsInView(e)?s(e,i.getNode(e)):a.current.add(e)},[n,s,i]),observe:i.observe}}({scrollableRef:m}),b=function(e){let{initialDate:t,scrollableRef:r}=e,a=(0,d.useRef)(t),i=(0,d.useRef)(null),n=rm({onInView:e=>{let t=e.dataset.date;t&&t!==a.current&&s(t)},rootMargin:"0px 0px -99% 0px",scrollableRef:r,threshold:.01}),s=(0,d.useCallback)(e=>{var t;a.current=e,null==(t=i.current)||t.setDate(e)},[]);return!function(e,t){let r=(0,rg.A)(t,()=>!0);(0,d.useEffect)(()=>e(r||[]),t)}(e=>{let[r]=e;!r&&t&&s(t)},[t]),{initialDate:t,observe:n.observe,pinnedDateRef:i}}({initialDate:p.firstMessageDate,scrollableRef:m}),y=function(e){let{highlightMessage:t,lastId:r,messageIndexById:a,ready:i,scrollToIndex:n,setVirtualizerShift:s,unreadMessageCount:o,unreadMessageIds:l}=e,{load:c}=(0,j.on)(),u=(0,d.useRef)(null),m=(0,d.useRef)(null),p=(0,d.useRef)(0),g=(0,d.useRef)(!1),f=(0,d.useCallback)(()=>{var e,t,n;let s,l={atBottom:(e={distanceFromBottom:p.current,lastId:r,messageIndexById:a,unreadMessageCount:o}).distanceFromBottom<=50,dialogueEndLoaded:!(t=e).lastId||"number"==typeof t.messageIndexById[t.lastId],farFromBottom:e.distanceFromBottom>300,hasUnreadMessages:e.unreadMessageCount>0};if(s=!!i&&(!l.dialogueEndLoaded||!l.atBottom&&(!!l.hasUnreadMessages||l.farFromBottom)),g.current!==s){null==(n=m.current)||n.setShow(s),g.current=s}},[r,a,i,o]),h=(0,d.useCallback)(e=>{var t;u.current=e,null==(t=m.current)||t.setLoading(!0),s(!1),c({targetMessageId:e.id}).catch(()=>{u.current=null})},[c,s]),x=(0,d.useCallback)(e=>{n(e.index,{smooth:e.smooth}),e.highlight&&t(e.id)},[t,n]),v=(0,eS.F)(()=>{if(u.current)return;let{index:e,metadata:t}=function(e){var t;let r,a=null==(t=e.unreadMessageIds)?void 0:t[0];return r="number"==typeof a?a:e.lastId||0,{index:e.messageIndexById[r],metadata:{highlight:r===a,id:r}}}({lastId:r,messageIndexById:a,unreadMessageIds:l});"number"==typeof e?x({...t,index:e,smooth:!0}):h(t)}),b=(0,eS.F)(e=>{p.current=e.bottom,f()});if(u.current){let e=a[u.current.id];if("number"==typeof e){var y;x({...u.current,index:e}),null==(y=m.current)||y.setLoading(!1),u.current=null}}return(0,d.useEffect)(f,[f]),(0,d.useEffect)(()=>{var e;return null==(e=m.current)?void 0:e.setUnreadCount(o)},[o]),{buttonRef:m,onClick:v.current,onScroll:b.current}}({highlightMessage:v.highlight,lastId:null==(t=r.lastMessage)?void 0:t.id,messageIndexById:p.messageIndexById,ready:g.ready,scrollToIndex:g.scrollToIndex,setVirtualizerShift:g.setVirtualizerShift,unreadMessageCount:r.unreadMessageCount,unreadMessageIds:r.unreadMessageIds}),k=function(e){let{highlightMessage:t,messageIndexById:r,scrollToIndex:a,setVirtualizerShift:i}=e,{load:n}=(0,j.on)(),[s]=(0,H.Bd)(),o=(0,eS.F)((0,eN.N)().api),l=(0,d.useRef)(null),c=(0,d.useCallback)(e=>{let{messageId:r,messageIndex:i,smooth:n}=e;a(i,{smooth:n}),t(r)},[t,a]),u=(0,d.useCallback)(async e=>!!(await o.current.getMessages({id:[e]})).messages[0],[o]),m=(0,d.useCallback)(async e=>{if(l.current)return;let t=r[e];if("number"==typeof t)return c({messageId:e,messageIndex:t});try{if(!await u(e))return tg({message:s("Сообщение не найдено")});l.current={id:e},i(!1),n({targetMessageId:e})}catch(e){l.current=null}},[s,u,c,n,r,i]);if(l.current){let e=l.current.id,t=r[e];"number"==typeof t&&(c({messageId:e,messageIndex:t}),l.current=null)}return{goToReplyMessage:m}}({highlightMessage:v.highlight,messageIndexById:p.messageIndexById,scrollToIndex:g.scrollToIndex,setVirtualizerShift:g.setVirtualizerShift}),w=(0,eS.F)((e,t)=>{x.observe(e.id,t),v.observe(e.id,t),b.observe(e.id,t)}),C=(0,eS.F)(e=>{let t=g.trackScrollPosition(e);y.onScroll(t),f.onScroll(t)}),I=(0,d.useMemo)(()=>p.messages.map((e,t,r)=>(0,a.jsx)(rn,{client:i,id:e.id,index:t,isMessageReadSub:h,message:e,messageSubscription:s,nextMessage:r[t+1],onRef:w.current,onReplyClick:k.goToReplyMessage,onSendMarkupVariant:l,prevMessage:r[t-1],users:c},e.id)),[i,h,s,p.messages,w,l,k.goToReplyMessage,c]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:u.chat,ref:m,children:[(0,a.jsx)(rl,{initialDate:b.initialDate,ref:b.pinnedDateRef}),(0,a.jsx)(tS.YV,{onScroll:C.current,ref:g.virtualizerRef,scrollRef:m,shift:g.virtualizerShift,startMargin:rc,children:I})]}),(0,a.jsx)(tT,{onClick:y.onClick,ref:y.buttonRef})]})});rf.displayName="WidgetBody";let rh=(0,d.memo)(e=>{let{messages:t,...r}=e,{classes:i}=rd();return(0,a.jsxs)("div",{className:i.wrapper,children:[!t&&(0,a.jsx)("div",{className:i.loader,children:(0,a.jsx)(tN.a,{})}),!!t&&(0,a.jsx)(rf,{messages:t,...r})]})});rh.displayName="WidgetBody";var rx=r(69943),rv=r(63887);let rb=(0,S.r)(()=>({container:{alignItems:"center",boxSizing:"content-box",display:"flex",flexDirection:"column",minHeight:46,position:"relative"},column:{flex:"none"},columnComment:{flex:"auto"},grid:{alignItems:"center",margin:0,padding:"4px 12px",width:"100%"}})),ry=(0,S.r)((e,t)=>({fileButton:{cursor:t?"not-allowed":"pointer",".icon.icon-tabler-paperclip":{transform:"scale(".concat("rtl"===e.dir?"-1":"1",", 1)")},"&:hover":{color:e.colors.gray[7]}}})),rj=(0,S.r)(()=>({comment:{width:"100%"}})),rk=(0,S.r)(e=>({emojiButton:{".icon":{stroke:"currentColor"},"&:disabled":{color:e.colors.gray[6],cursor:"not-allowed"},"&:hover":{color:e.colors.gray[7]}},emojiPicker:{bottom:72,left:24,position:"absolute",zIndex:3,"em-emoji-picker":{maxHeight:350}}})),rw=(0,S.r)((e,t)=>{let{inSlowMode:r}=t;return{sendButton:{backgroundColor:"dark"===e.colorScheme?e.colors[e.primaryColor][8]:e.colors[e.primaryColor][6],"&:hover":{backgroundColor:"dark"===e.colorScheme?e.colors[e.primaryColor][8]:e.colors[e.primaryColor][7]},".icon.icon-tabler-send":{marginRight:3,transform:"rotateZ(".concat("rtl"===e.dir?"220deg":"40deg",")")}},slowModeCircle:{"> svg":{display:r?"inherit":"none"}},tooltip:{textAlign:"center"}}}),rC=(0,S.r)(e=>({invokeButton:{width:"100%",button:{border:"none",borderTop:"1px solid ".concat("dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]),borderTopLeftRadius:0,borderTopRightRadius:0}}})),rI=(0,d.forwardRef)((e,t)=>{let{blocked:r,changeComment:i,sendMessage:n,slowMode:s,value:o}=e,[l]=(0,H.Bd)(),c=(0,d.useRef)(null),{classes:u}=rj(),m=eb({interval:1e3,slowMode:s}),p=(0,d.useCallback)(e=>{i(e.target.value)},[i]),g=(0,d.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n())},[n]),f=(0,d.useMemo)(()=>(null==m?void 0:m.formatted)||l("Напишите сообщение")+"...",[l,null==m?void 0:m.formatted]);return(0,d.useImperativeHandle)(t,()=>({blur:()=>{var e;return null==(e=c.current)?void 0:e.blur()},focus:()=>{var e;return null==(e=c.current)?void 0:e.focus()},getSelectionRange:()=>{var e,t,r,a;return[null!=(r=null==(e=c.current)?void 0:e.selectionStart)?r:0,null!=(a=null==(t=c.current)?void 0:t.selectionEnd)?a:0]}}),[]),(0,a.jsx)(ex.T,{autoFocus:!0,autosize:!0,className:u.comment,disabled:r,maxRows:4,onChange:p,onKeyDown:g,placeholder:f,ref:c,size:"md",value:o,variant:"unstyled",...N("write-message-textarea",!0)})});rI.displayName="WidgetFooterComment";var rM=r(99351),rN=r(46978),rS=r(61946);let rR=["people","nature","foods","activity","places","objects","symbols"],rA=e=>{let{blocked:t,changeComment:r,comment:i,commentRef:n}=e,{classes:s}=rk(),[o,l]=(0,ej.A)(!1),c=(0,d.useRef)(null),u=(0,rS.xd)(),m=(0,d.useCallback)(e=>{var t;(null==(t=c.current)?void 0:t.contains(e.target))||l.setFalse()},[l]),p=(0,d.useCallback)(e=>{let t=e.native,[a,s]=(null==n?void 0:n.getSelectionRange())||[0,0];r([i.slice(0,a),t,i.slice(s)].join("")),requestAnimationFrame(()=>{null==n||n.focus(),document.execCommand("insertText",!1,t)})},[r,i,n]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.M,{className:s.emojiButton,disabled:t,ref:c,size:24,variant:"transparent",children:(0,a.jsx)(M.N0L,{name:"emoji-button",onClick:l.toggle})}),o&&(0,a.jsx)("div",{className:s.emojiPicker,children:(0,a.jsx)(rN.A,{autoFocus:!0,categories:rR,data:rM,locale:null===H.Ru||void 0===H.Ru?void 0:H.Ru.language,onClickOutside:m,onEmojiSelect:p,set:"emojione",skinTonePosition:"search",theme:u.colorScheme})})]})};var rT=r(42035);let rz=e=>{let{blocked:t,maxFiles:r,onFilesChange:i}=e,{classes:n}=ry(t),s=(0,d.useRef)(null),o=(0,d.useCallback)(e=>{var t;i(e),null==(t=s.current)||t.call(s)},[i]);return(0,a.jsx)(rT.H,{disabled:t,multiple:r>1,onChange:o,resetRef:s,children:e=>(0,a.jsx)(I.M,{...e,className:n.fileButton,size:22,variant:"transparent",...N("upload-button"),children:(0,a.jsx)(M.ETA,{})})})},rB=e=>{let{onClick:t,show:r}=e,[i]=(0,H.Bd)(),{classes:n}=rC();return r?(0,a.jsx)("div",{className:n.invokeButton,children:(0,a.jsx)(eo.$,{fullWidth:!0,onClick:t,size:"xs",variant:"default",...N("invoke-operator-button"),children:i("Позвать оператора")})}):null},rD=e=>{let{blocked:t,commentRef:r,sendMessage:i,slowMode:n}=e,[s]=(0,H.Bd)(),{classes:o}=rw({inSlowMode:n.active}),l=(0,rS.xd)(),c=eb({interval:16,slowMode:n}),u=(0,d.useMemo)(()=>{if(c)return s("Вы сможете отправить сообщение через {{time}}",{time:c.formatted})},[s,c]),m=(0,d.useMemo)(()=>c?[{color:l.colors.primary[9]||"green",value:c.percentage}]:[],[c,l.colors.primary]),p=(0,d.useCallback)(()=>{i(),null==r||r.focus()},[r,i]);return(0,a.jsx)(et.m,{className:o.tooltip,disabled:!n.active,label:u,multiline:!0,w:170,withArrow:!0,...N("send-button-slowmode-tooltip"),children:(0,a.jsx)(eJ.W,{className:o.slowModeCircle,label:(0,a.jsx)(eq.o,{children:(0,a.jsx)(I.M,{className:o.sendButton,disabled:t||n.active,onClick:p,size:32,radius:"xl",variant:"filled",...N("send-button",!0),children:(0,a.jsx)(M.mDt,{size:20})})}),roundCaps:!0,sections:m,size:46,thickness:2,...N("send-button-slowmode-loader")})})},rE=(0,d.memo)(e=>{let{invoke:t,messageCreation:r,slowMode:i}=e,{classes:n}=rb(),s=(0,d.useRef)(null);return(0,a.jsxs)("div",{className:n.container,children:[(0,a.jsxs)(rx.x,{align:"flex-end",className:n.grid,gutter:8,children:[(0,a.jsx)(rv.f,{className:n.column,children:(0,a.jsx)(rz,{blocked:r.blocked,maxFiles:r.maxFiles,onFilesChange:r.onFilesChange})}),(0,a.jsx)(rv.f,{className:n.columnComment,children:(0,a.jsx)(rI,{blocked:r.blocked,changeComment:r.onCommentChange,ref:s,sendMessage:r.sendMessage,slowMode:i,value:r.message.comment})}),(0,a.jsx)(rv.f,{className:n.column,children:(0,a.jsx)(rA,{blocked:r.blocked,changeComment:r.onCommentChange,comment:r.message.comment,commentRef:s.current})}),(0,a.jsx)(rv.f,{className:n.column,children:(0,a.jsx)(rD,{blocked:r.blocked,commentRef:s.current,sendMessage:r.sendMessage,slowMode:i})})]}),(0,a.jsx)(rB,{onClick:t.invoke,show:t.allowed})]})});rE.displayName="WidgetFooter";let r_=(0,S.r)(e=>({header:{alignItems:"center",display:"flex",gap:e.spacing.md,padding:e.spacing.lg},avatar:{flex:"none"},info:{display:"flex",flex:1,flexDirection:"column"},actions:{display:"flex",flex:"none",gap:e.spacing.md}})),rP=(0,S.r)(e=>({button:{color:"dark"===e.colorScheme?e.colors.dark[1]:e.colors.gray[7],"&:hover":{color:"dark"===e.colorScheme?e.colors.dark[0]:e.colors.gray[7]}},volume:{stroke:e.colors[e.primaryColor][9]}})),rF=e=>{let{close:t,sound:r}=e,[i]=(0,H.Bd)(),{classes:n}=rP();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(et.m,{label:i("Звуковые уведомления"),withArrow:!0,children:(0,a.jsx)(I.M,{className:n.button,size:26,variant:"transparent",...N("sound-button"),children:r.enabled?(0,a.jsx)(M.C3L,{className:n.volume,onClick:r.toggle}):(0,a.jsx)(M.XIB,{onClick:r.toggle})})}),(0,a.jsx)(I.M,{className:n.button,onClick:t,size:26,variant:"transparent",...N("close-widget-button"),children:(0,a.jsx)(M.MRt,{})})]})},rH=(0,eX.i7)({"0%, 80%, 100%":{boxShadow:"0 ".concat(5,"px 0 -0.7px"),opacity:.9},"40%":{boxShadow:"0 ".concat(5,"px 0 0"),opacity:1}}),rG=(0,S.r)((e,t)=>({root:{display:"flex",alignItems:"center",gap:7,".loader, .loader:before, .loader:after":{display:"inline-flex",width:5,height:5,borderRadius:"50%",animation:"".concat(rH," 0.8s infinite ease-in-out"),animationFillMode:"both"},".loader":{position:"relative",transform:"translateY(-".concat(5,"px)"),marginLeft:7,marginRight:7,"&:before, &:after":{content:'""',position:"absolute",top:0},"&:before":{left:-7,animationDelay:"-0.18s"},"&:after":{left:7,animationDelay:"0.18s"}}}}));var rO=r(29559);let rW=e=>{let{data:t,...r}=e,[i]=(0,H.Bd)(),{classes:n}=rG(),s=(0,u.G)(e=>e.users.byId),o=null==s?void 0:s[t.fromId],l="Unknown";switch(null==o?void 0:o.$type){case"Client":l=i("Клиент №{{n}}",{n:o.publicId});break;case"OperatorBot":l=i("Ассистент");break;case"Operator":var c;o.id!==(null==(c=rO.A.getState().currentUser.entity)?void 0:c.id)&&(l=o.name)}return(0,a.jsxs)("div",{className:n.root,children:[(0,a.jsx)("span",{className:"loader"})," ",i("{{user}} печатает",{user:l})]})},rL=e=>{let{name:t,typingStatus:r}=e,[i]=(0,H.Bd)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(G.E,{size:"sm",weight:500,...N("operator-name"),children:t}),!!r&&(0,a.jsx)(G.E,{size:"xs",children:(0,a.jsx)(rW,{data:r})}),!r&&(0,a.jsx)(G.E,{color:"dimmed",size:"xs",children:i("Оператор").toLocaleLowerCase()})]})},r$=(0,d.memo)(e=>{let{close:t,operator:r,sound:i,typingStatus:n}=e,[s]=(0,H.Bd)(),{classes:o}=r_();return(0,a.jsxs)("div",{className:o.header,children:[!r&&(0,a.jsx)("div",{className:o.info,children:s("Чат с поддержкой")}),!!r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:o.avatar,children:(0,a.jsx)(tG,{testIdPrefix:"header",user:r})}),(0,a.jsx)("div",{className:o.info,children:(0,a.jsx)(rL,{name:r.name,typingStatus:n})})]}),(0,a.jsx)("div",{className:o.actions,children:(0,a.jsx)(rF,{close:t,sound:i})})]})});r$.displayName="WidgetHeader";let rV=(0,d.memo)(e=>{let{close:t,isMobile:r}=e,i=(0,u.G)(m._5),s=(0,u.G)(o.ZB),l=(0,u.G)(c.hd),p=(0,u.G)(x.xu),f=(0,u.G)(k.Ys),h=(0,u.G)(c.gq),y=(0,u.G)(k.o9),C=(0,u.G)(w.uN),I=function(){let{api:e}=(0,eN.N)(),t=(0,u.j)(),r=(0,u.G)(e=>e.feedback),{runAsync:a}=(0,tr.A)(async t=>{let{dialogueId:r,rate:a,resolved:i}=t;await e.setChatFeedback(r,{rate:a,resolved:i})},{loadingDelay:300,manual:!0}),i=(0,d.useCallback)(()=>t((0,b.v4)()),[t]),n=(0,d.useCallback)(async e=>{if(r.dialogId)try{await a({dialogueId:r.dialogId,...to({rate:e.rate,resolved:e.resolved})}),e.onSuccess()}catch(t){e.onFailure()}},[r.dialogId,a]);return{open:!!r.dialogId,reset:i,submit:n}}(),M=function(e){let{chat:t,operator:r}=e,{api:a}=(0,eN.N)(),i=!!((null==t?void 0:t.operatorInvokeAllowed)&&!r);return(0,d.useMemo)(()=>({allowed:i,invoke:a.invokeOperator}),[i,a.invokeOperator])}({chat:l,operator:h}),S=function(){let{api:e}=(0,eN.N)(),t=(0,u.G)(k.o9),r=(0,u.G)(k.Tf),a=(0,d.useRef)(e),i=(0,d.useRef)(new Map),n=(0,d.useRef)(r);a.current=e,n.current=r;let s=(0,d.useCallback)(e=>(i.current.has(e)||i.current.set(e,tC()),i.current.get(e)),[]),o=(0,d.useCallback)((e,t)=>{let r={...s(e),...t};i.current.set(e,r)},[s]),l=(0,d.useCallback)((e,t)=>{s(e).listeners.add(t)},[s]),c=(0,d.useCallback)((e,t)=>{s(e).listeners.delete(t)},[s]),m=(0,d.useCallback)(e=>{let t=s(e);t.listeners.forEach(e=>{e(t.message)})},[s]),p=(0,d.useCallback)(e=>{var t;return null==(t=n.current)?void 0:t[e]},[]),g=(0,d.useCallback)(async e=>{try{let t=p(e);if(!t){let r=[e];t=(await a.current.getMessages({id:r})).messages[0]||tw()}o(e,{message:t})}catch(t){o(e,tC())}finally{m(e)}},[p,m,o]),f=(0,d.useCallback)((e,t)=>{l(e,t),g(e)},[l,g]);return(0,d.useEffect)(()=>{Array.from(i.current.entries()).forEach(e=>{let[a,i]=e,n=tk()(t),s=null==r?void 0:r[a],l=!!n&&n.id<=a;!s&&l?(o(a,{message:tw()}),m(a)):s&&s!==i.message&&(o(a,{message:s}),m(a))})},[t,r,m,o]),(0,d.useMemo)(()=>({getByIdFromCache:p,subscribe:f,unsubscribe:c}),[p,c,f])}(),R=function(e){let{chat:t,lastSentMessage:r}=e,[a,i]=(0,d.useState)(!1),n=(0,d.useRef)(null),s=(0,d.useCallback)(()=>{n.current&&clearTimeout(n.current)},[]),o=(0,d.useCallback)((e,t)=>{let r=E()(),a=E().unix(t);return Math.max(0,1e3*e-r.diff(a,"milliseconds"))},[]);return(0,d.useEffect)(()=>{(null==t?void 0:t.slowModeDelay)&&r&&(s(),i(!0),n.current=setTimeout(()=>i(!1),o(t.slowModeDelay,r.createdAt)))},[null==t?void 0:t.slowModeDelay,s,o,r]),(0,d.useEffect)(()=>s,[s]),(0,d.useMemo)(()=>{var e,i;return{active:a,activeSince:null!=(e=null==r?void 0:r.createdAt)?e:0,duration:null!=(i=null==t?void 0:t.slowModeDelay)?i:0,getDiffMs:o}},[a,null==t?void 0:t.slowModeDelay,o,null==r?void 0:r.createdAt])}({chat:l,lastSentMessage:f}),T=function(e){let{chat:t,inSlowMode:r}=e,[a]=(0,H.Bd)(),[i,n]=(0,d.useState)(ty),[s,o]=(0,ej.A)(!1),l=(0,eN.N)(),c=(0,u.G)(v.Jz),m=(0,u.G)(g.eC),p=!!(null==t?void 0:t.writeBlocked),f=Math.max(0,A.BE-i.files.length),h=function(){let e=(0,u.j)();return(0,d.useCallback)(t=>{e((0,v.Z_)(t))},[e])}(),x=(0,j.bR)();(0,tl.A)(()=>{c&&(n(e=>({comment:c||"",files:e.files})),h(""))}),(0,tc.A)(()=>{i.comment&&h(i.comment)});let b=(0,d.useCallback)(async e=>{try{await x(e.comment,e.files),o.setFalse(),n({...ty})}catch(e){tg({message:a("Не удалось отправить, попробуйте еще раз")})}},[a,o,x]),y=(0,d.useCallback)(e=>{let t={...i,comment:(null!=e?e:i.comment).trim()};!p&&!r&&(t.files.length?t.comment.length<=A.N$.MAX:t.comment.length>=A.N$.MIN&&t.comment.length<=A.N$.MAX)&&b(t)},[p,r,i,b]),k=(0,d.useCallback)(e=>n(t=>({...t,...e})),[]),w=(0,tm.dh)(e=>void l.api.setMessageTyping(e).catch(),3e3,{trailing:!1}),C=(0,d.useCallback)(e=>{!p&&e.length<=A.N$.MAX&&(k({comment:e}),w(e))},[p,w,k]),I=(0,d.useCallback)(async e=>{if(p)return;let t=await th({files:tu()(e,"name"),settings:{maxFiles:A.BE,restrictions:m}});"errors"in t?t.errors.forEach(e=>tg({...N("files-validation-err-notification"),message:"file-too-large"===e.code?a("Размер файла {{fileType}} не должен превышать {{max}} Мб",{fileType:e.details.fileType,max:Math.round(e.details.maxSize/1024/1024)}):"invalid-file-contents"===e.code?a("Файл не поддерживается"):"invalid-file-format"===e.code?a("Формат {{fileType}} не поддерживается",{fileType:e.details.fileType}):a("Вы не можете загрузить более {{n}} файлов",{n:e.details.maxCount}),closeButtonProps:{...N("files-validation-err-notification-btn")}})):t.files.length?(k({files:t.files}),o.setTrue()):(k({files:[]}),o.setFalse())},[a,p,o,m,k]),M=(0,d.useCallback)(()=>{o.setFalse(),k({files:[]})},[o,k]),S={blocked:p,comment:i.comment,files:i.files,maxFiles:f,onCancel:M,onFilesChange:I,open:s,sendMessage:y};return{dropzone:{disabled:p||s,maxFiles:f,onDrop:I},footer:{blocked:p,maxFiles:f,message:i,onCommentChange:C,onFilesChange:I,sendMessage:y},modal:S}}({chat:l,inSlowMode:R.active}),z=function(e){let{inSlowMode:t}=e,r=(0,eS.F)(t),a=(0,j.bR)();return{send:(0,d.useCallback)(e=>{r.current||a(e.text,void 0,{$type:"SelectVariantCommand",variantId:e.id})},[a,r])}}({inSlowMode:R.active}),D=function(){let{cookies:e}=(0,n.L)(),t=(0,u.G)(m.jf),r=(0,u.j)();(0,tl.A)(()=>{(async()=>{let t=await tI(e);null===t?(r((0,m.RJ)(!0)),await tM(e,1)):r((0,m.RJ)(!!t))})()});let a=(0,d.useCallback)(async()=>{let a=+!t,i=!t;r((0,m.RJ)(i)),await tM(e,a)},[e,r,t]);return(0,d.useMemo)(()=>({enabled:!!t,toggle:a}),[t,a])}(),_=!!l&&!s&&i===B.i.Ready;return!function(e){let t=(0,d.useCallback)(t=>{if("clipboardData"in t){var r;(null==(r=t.clipboardData)?void 0:r.files.length)&&e(Array.from(t.clipboardData.files))}},[e]);(0,d.useEffect)(()=>(window.addEventListener("paste",t),()=>{window.removeEventListener("paste",t)}),[t])}(T.footer.onFilesChange),!function(e){let{messages:t}=e,r=(0,u.G)(c.hd),{load:a}=(0,j.on)();(0,d.useEffect)(()=>{t||a({syncUnreadIds:!0})},[r,a,t])}({messages:y}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tt,{isMobile:r,header:(0,a.jsx)(r$,{close:t,operator:h,sound:D,typingStatus:null==l?void 0:l.typingStatus}),body:(0,a.jsxs)(eh,{...T.dropzone,children:[(0,a.jsx)(U,{appStatus:i,authError:s}),_&&(0,a.jsx)(rh,{chat:l,client:p,invokeOperatorShown:M.allowed,messageSubscription:S,messages:y,onSendMarkupVariant:z.send,users:C})]}),footer:_&&!!y&&(0,a.jsx)(rE,{invoke:M,messageCreation:T.footer,slowMode:R})}),(0,a.jsx)(em,{...I}),(0,a.jsx)(e7,{...T.modal,slowMode:R})]})});rV.displayName="Widget";let rX=(0,S.r)(e=>({header:{alignItems:"center",display:"flex",gap:e.spacing.md,padding:e.spacing.lg},info:{display:"flex",flex:1},actions:{display:"flex",flex:"none",gap:e.spacing.md},button:{color:"dark"===e.colorScheme?e.colors.dark[1]:e.colors.gray[7],"&:hover":{color:"dark"===e.colorScheme?e.colors.dark[0]:e.colors.gray[7]}}})),rU=e=>{let{close:t}=e,[r]=(0,H.Bd)(),{classes:i}=rX();return(0,a.jsxs)("div",{className:i.header,children:[(0,a.jsx)("div",{className:i.info,children:r("Чат с поддержкой")}),(0,a.jsx)("div",{className:i.actions,children:(0,a.jsx)(I.M,{className:i.button,onClick:t,size:26,variant:"transparent",...N("close-widget-button"),children:(0,a.jsx)(M.MRt,{})})})]})},rY=e=>{let{banned:t,close:r,isMobile:i}=e,[n]=(0,H.Bd)(),s=n("Вас временно заблокировали в чате"),o=n("К сожалению, поддержка временно недоступна");return(0,a.jsx)(tt,{isMobile:i,header:(0,a.jsx)(rU,{close:r}),body:(0,a.jsx)(P.F,{color:"red",icon:(0,a.jsx)(M.GBC,{size:16}),title:n("Чат недоступен"),...N(t?"client-banned-alert":"chat-unavailable-alert"),children:t?s:o})})},rJ=()=>{let{params:e}=(0,n.L)(),{classes:t}=_({isMobile:e.isMobile}),r=(0,u.G)(o.HJ),v=(0,u.G)(c.hd),b=(0,u.G)(o.P3),y=(0,u.G)(m.lq),j=function(){let{params:e}=(0,n.L)();return(0,d.useMemo)(()=>(0,s.jP)({isMobile:e.isMobile,language:e.language,position:e.position}),[e.isMobile,e.language,e.position]).orientation}(),w=function(){let e=(0,u.j)(),{params:t,setFrameSize:r}=(0,n.L)();return(0,d.useCallback)(async()=>{await r("collapse",{isMobile:t.isMobile,opener:t.opener}),e((0,m.pj)(!1))},[e,t,r])}(),C=function(){let e=(0,u.j)(),{params:t,setFrameSize:r}=(0,n.L)();return(0,d.useCallback)(async()=>{await r("open",{isMobile:t.isMobile,opener:t.opener}),e((0,m.pj)(!0))},[e,t,r])}();return!function(){let e=(0,u.G)(m._5),t=(0,l.c)(),r=function(){let{api:e}=(0,p.N)(),t=(0,u.j)(),r=(0,h.A)(e=>e.env),a=(0,f.P)(r);return(0,d.useCallback)(async()=>{try{let r=await e.getConfiguration();if(!r)return;t((0,g.xN)(r))}catch(e){a.error(e)}},[e,t,a])}(),a=function(){let{api:e}=(0,p.N)(),t=(0,u.j)(),r=(0,h.A)(e=>e.env),a=(0,f.P)(r);return(0,d.useCallback)(async()=>{try{let r=await e.getCurrentUser();if(!r)return;t((0,x.lt)(r))}catch(e){a.error(e)}},[e,t,a])}(),i=(0,u.j)(),n=(0,h.A)(e=>e.env),s=(0,f.P)(n);(0,d.useEffect)(()=>{e===B.i.Syncing&&Promise.all([t(),r(),a()]).then(()=>{i((0,k.A3)()),i((0,m.KE)(B.i.Ready))}).catch(e=>{s.error("Sync failed",e)})},[e,i,t,r,a,s])}(),!function(){let e=(0,u.j)(),{cookies:t}=(0,n.L)(),r=(0,u.G)(m.lq),a=(0,d.useRef)(),i=(0,d.useRef)(null),s=(0,d.useCallback)(()=>{a.current&&(clearTimeout(a.current),a.current=null)},[]),o=(0,d.useCallback)(()=>{i.current&&(clearInterval(i.current),i.current=null)},[]),l=(0,d.useCallback)(()=>{let r=E()(),a=r.toISOString();e((0,m.uV)(a)),t.set(A.Zv.lastActivity,a,{expires:r.add(A.xU).toDate(),path:"/"})},[t,e]);(0,d.useEffect)(()=>(r?(l(),i.current=setInterval(l,15e3)):o(),o),[o,l,r]),(0,d.useEffect)(()=>{function t(){document.hidden?a.current=setTimeout(()=>e((0,m.pj)(!1)),A.xU):s()}return document.addEventListener("visibilitychange",t),function(){document.removeEventListener("visibilitychange",t),s()}},[s,e])}(),(0,a.jsx)("div",{className:t.root,children:(0,a.jsxs)("div",{className:t.container,children:["hidden"!==function(e){return T(e)?e.type:e}(e.opener)&&(0,a.jsx)(i.A,{in:!y,timeout:{enter:400,exit:100},unmountOnExit:!0,children:(0,a.jsx)(z,{onOpenWidget:C,opener:e.opener,orientation:j,unreadMessageCount:null==v?void 0:v.unreadMessageCount})}),(0,a.jsx)(i.A,{in:y,timeout:200,unmountOnExit:!0,children:(0,a.jsxs)(a.Fragment,{children:[(r||b)&&(0,a.jsx)(rY,{banned:!!r,close:w,isMobile:e.isMobile}),!r&&!b&&(0,a.jsx)(rV,{close:w,isMobile:e.isMobile})]})})]})})};var rq=!0;let rZ=()=>(0,a.jsx)(rJ,{})}},e=>{var t=t=>e(e.s=t);e.O(0,[273,307,345,582,636,593,792],()=>t(17703)),_N_E=e.O()}]);